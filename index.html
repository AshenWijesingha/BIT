<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="BIT Repository - Browse and view PDF course materials for Bachelor of Information Technology program. Access lecture notes, tutorials, and study materials for BIT students.">
    <meta name="theme-color" content="#2563eb">
    <meta name="author" content="BIT Repository">
    <meta name="keywords" content="BIT, Bachelor of Information Technology, PDF, course materials, study materials, university, lecture notes, tutorials, IT education, computing, semester materials">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://ashenwijesingha.github.io/BIT/">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/jpeg" href="https://res.cloudinary.com/dkj22lm1g/image/upload/w_32,h_32,c_fill/v1768415117/BIT_Repository_xropb0.jpg">
    <link rel="icon" type="image/jpeg" sizes="16x16" href="https://res.cloudinary.com/dkj22lm1g/image/upload/w_16,h_16,c_fill/v1768415117/BIT_Repository_xropb0.jpg">
    <link rel="icon" type="image/jpeg" sizes="32x32" href="https://res.cloudinary.com/dkj22lm1g/image/upload/w_32,h_32,c_fill/v1768415117/BIT_Repository_xropb0.jpg">
    <link rel="icon" type="image/jpeg" sizes="96x96" href="https://res.cloudinary.com/dkj22lm1g/image/upload/w_96,h_96,c_fill/v1768415117/BIT_Repository_xropb0.jpg">
    <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/dkj22lm1g/image/upload/w_180,h_180,c_fill/v1768415117/BIT_Repository_xropb0.jpg">
    
    <!-- Open Graph meta tags for social sharing -->
    <meta property="og:title" content="BIT Repository - PDF Viewer | Course Materials for BIT Students">
    <meta property="og:description" content="Browse and view PDF course materials for Bachelor of Information Technology program. Access lecture notes, tutorials, and study materials organized by semester.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ashenwijesingha.github.io/BIT/">
    <meta property="og:image" content="https://res.cloudinary.com/dkj22lm1g/image/upload/w_1200,h_630,c_fill/v1768415117/BIT_Repository_xropb0.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="BIT Repository Logo - Bachelor of Information Technology Course Materials">
    <meta property="og:site_name" content="BIT Repository">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="BIT Repository - PDF Viewer | Course Materials for BIT Students">
    <meta name="twitter:description" content="Browse and view PDF course materials for Bachelor of Information Technology program. Access lecture notes and study materials.">
    <meta name="twitter:image" content="https://res.cloudinary.com/dkj22lm1g/image/upload/w_1200,h_630,c_fill/v1768415117/BIT_Repository_xropb0.jpg">
    <meta name="twitter:image:alt" content="BIT Repository Logo">
    
    <title>BIT Repository - PDF Viewer | Bachelor of Information Technology Course Materials</title>
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "BIT Repository",
        "alternateName": "Bachelor of Information Technology Repository",
        "url": "https://ashenwijesingha.github.io/BIT/",
        "description": "Browse and view PDF course materials for Bachelor of Information Technology program. Access lecture notes, tutorials, and study materials.",
        "image": "https://res.cloudinary.com/dkj22lm1g/image/upload/v1768415117/BIT_Repository_xropb0.jpg",
        "publisher": {
            "@type": "Organization",
            "name": "BIT Repository",
            "logo": {
                "@type": "ImageObject",
                "url": "https://res.cloudinary.com/dkj22lm1g/image/upload/v1768415117/BIT_Repository_xropb0.jpg"
            }
        },
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://ashenwijesingha.github.io/BIT/?pdf={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF.js library for rendering PDFs on all devices including mobile -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        /* Tailwind-like utility classes as fallback when CDN is blocked */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; }
        .min-h-screen { min-height: 100vh; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-white { background-color: #ffffff; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-blue-700 { background-color: #1d4ed8; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-gray-800 { background-color: #1f2937; }
        .text-white { color: #ffffff; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-400 { color: #9ca3af; }
        .text-yellow-500 { color: #eab308; }
        .text-red-500 { color: #ef4444; }
        .text-blue-500 { color: #3b82f6; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-base { font-size: 1rem; line-height: 1.5rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-center { text-align: center; }
        .flex { display: flex; }
        .inline-flex { display: inline-flex; }
        .hidden { display: none !important; }
        .block { display: block; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .flex-col { flex-direction: column; }
        .flex-1 { flex: 1 1 0%; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-shrink-0 { flex-shrink: 0; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .p-1\.5 { padding: 0.375rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-1\.5 { padding-top: 0.375rem; padding-bottom: 0.375rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .pt-16 { padding-top: 4rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-2 { margin-top: 0.5rem; }
        .ml-4 { margin-left: 1rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .w-64 { width: 16rem; }
        .w-80 { width: 20rem; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .h-3 { height: 0.75rem; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .h-6 { height: 1.5rem; }
        .h-12 { height: 3rem; }
        .h-16 { height: 4rem; }
        .h-20 { height: 5rem; }
        .h-24 { height: 6rem; }
        .w-3 { width: 0.75rem; }
        .w-4 { width: 1rem; }
        .w-5 { width: 1.25rem; }
        .w-6 { width: 1.5rem; }
        .w-12 { width: 3rem; }
        .w-16 { width: 4rem; }
        .w-20 { width: 5rem; }
        .w-24 { width: 6rem; }
        .max-w-xs { max-width: 20rem; }
        .max-w-sm { max-width: 24rem; }
        .max-w-md { max-width: 28rem; }
        .max-w-lg { max-width: 32rem; }
        .min-w-0 { min-width: 0; }
        .fixed { position: fixed; }
        .sticky { position: sticky; }
        .relative { position: relative; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .top-14 { top: 3.5rem; }
        .top-16 { top: 4rem; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        .overflow-y-auto { overflow-y: auto; }
        .overflow-x-hidden { overflow-x: hidden; }
        .overflow-hidden { overflow: hidden; }
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-t-lg { border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; }
        .rounded-b-lg { border-bottom-left-radius: 0.5rem; border-bottom-right-radius: 0.5rem; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .break-words { overflow-wrap: break-word; word-break: break-word; }
        .whitespace-nowrap { white-space: nowrap; }
        .cursor-pointer { cursor: pointer; }
        .transition-transform { transition-property: transform; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .duration-300 { transition-duration: 300ms; }
        .border { border-width: 1px; }
        .border-gray-200 { border-color: #e5e7eb; }
        
        /* Transform utilities */
        .-translate-x-full { transform: translateX(-100%); }
        .translate-x-0 { transform: translateX(0); }
        .rotate-90 { transform: rotate(90deg); }
        
        /* Hover states */
        .hover\:bg-gray-100:hover { background-color: #f3f4f6; }
        .hover\:bg-gray-300:hover { background-color: #d1d5db; }
        .hover\:bg-blue-600:hover { background-color: #2563eb; }
        .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\:bg-blue-800:hover { background-color: #1e40af; }
        
        /* Mobile-first responsive utilities */
        /* Extra small devices (phones, less than 480px) */
        @media (max-width: 480px) {
            .xs\:hidden { display: none !important; }
            .xs\:block { display: block !important; }
            .xs\:flex { display: flex !important; }
            .xs\:text-xs { font-size: 0.75rem; line-height: 1rem; }
            .xs\:text-sm { font-size: 0.875rem; line-height: 1.25rem; }
            .xs\:text-base { font-size: 1rem; line-height: 1.5rem; }
            .xs\:p-2 { padding: 0.5rem; }
            .xs\:p-3 { padding: 0.75rem; }
            .xs\:px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
            .xs\:py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
            .xs\:gap-1 { gap: 0.25rem; }
            .xs\:gap-2 { gap: 0.5rem; }
            .xs\:w-full { width: 100%; }
            .xs\:flex-col { flex-direction: column; }
            .xs\:flex-wrap { flex-wrap: wrap; }
            
            /* Improve touch targets for mobile - minimum 44x44px for accessibility */
            button, .sidebar-item, a[role="button"] { 
                min-height: 44px; 
                min-width: 44px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Better text sizes for mobile readability */
            body { font-size: 16px; } /* Prevent zoom on iOS */
            
            /* Adjust header for mobile */
            header h1 { 
                font-size: 0.875rem;
                gap: 0.375rem;
            }
            
            header h1 img {
                height: 1.75rem;
                width: 1.75rem;
            }
            
            /* Make buttons more prominent on mobile */
            header button { 
                padding: 0.5rem;
                min-width: 44px;
                min-height: 44px;
            }
            
            /* Sidebar improvements for mobile */
            .sidebar-item, .folder-container > div {
                padding: 0.625rem 0.5rem;
                min-height: 48px;
            }
            
            /* Footer adjustments for mobile */
            .footer {
                padding: 1rem 0.75rem;
                text-align: center;
            }
            
            .footer .flex {
                flex-direction: column;
                gap: 0.75rem;
            }
        }
        
        /* Small devices (phones, 480px and up) */
        @media (min-width: 480px) {
            .sm\:hidden { display: none !important; }
            .sm\:block { display: block !important; }
            .sm\:inline { display: inline !important; }
            .sm\:inline-flex { display: inline-flex !important; }
            .sm\:flex { display: flex !important; }
            .sm\:text-sm { font-size: 0.875rem; line-height: 1.25rem; }
            .sm\:text-base { font-size: 1rem; line-height: 1.5rem; }
            .sm\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
            .sm\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
            .sm\:p-2 { padding: 0.5rem; }
            .sm\:p-3 { padding: 0.75rem; }
            .sm\:p-4 { padding: 1rem; }
            .sm\:p-6 { padding: 1.5rem; }
            .sm\:px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
            .sm\:px-4 { padding-left: 1rem; padding-right: 1rem; }
            .sm\:py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
            .sm\:py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
            .sm\:gap-1 { gap: 0.25rem; }
            .sm\:gap-2 { gap: 0.5rem; }
            .sm\:gap-3 { gap: 0.75rem; }
            .sm\:gap-4 { gap: 1rem; }
            .sm\:mb-4 { margin-bottom: 1rem; }
            .sm\:h-5 { height: 1.25rem; }
            .sm\:w-5 { width: 1.25rem; }
            .sm\:h-6 { height: 1.5rem; }
            .sm\:w-6 { width: 1.5rem; }
            .sm\:h-4 { height: 1rem; }
            .sm\:w-4 { width: 1rem; }
            .sm\:h-20 { height: 5rem; }
            .sm\:w-20 { width: 5rem; }
            .sm\:flex-row { flex-direction: row; }
        }
        
        /* Medium devices (tablets, 768px and up) */
        @media (min-width: 768px) {
            .md\:hidden { display: none !important; }
            .md\:block { display: block !important; }
            .md\:inline-flex { display: inline-flex !important; }
            .md\:flex { display: flex !important; }
            .md\:text-base { font-size: 1rem; line-height: 1.5rem; }
            .md\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
            .md\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
            .md\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
            .md\:p-3 { padding: 0.75rem; }
            .md\:p-4 { padding: 1rem; }
            .md\:p-6 { padding: 1.5rem; }
            .md\:p-8 { padding: 2rem; }
            .md\:px-4 { padding-left: 1rem; padding-right: 1rem; }
            .md\:gap-3 { gap: 0.75rem; }
            .md\:gap-4 { gap: 1rem; }
            .md\:h-24 { height: 6rem; }
            .md\:w-24 { width: 6rem; }
            .md\:flex-row { flex-direction: row; }
        }
        
        /* Large devices (desktops, 1024px and up) */
        @media (min-width: 1024px) {
            .lg\:ml-80 { margin-left: 20rem; }
            .lg\:translate-x-0 { transform: translateX(0); }
            .lg\:hidden { display: none !important; }
            .lg\:block { display: block !important; }
            .lg\:inline-flex { display: inline-flex !important; }
            .lg\:flex { display: flex !important; }
            .lg\:text-base { font-size: 1rem; line-height: 1.5rem; }
            .lg\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
            .lg\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
            .lg\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
            .lg\:p-4 { padding: 1rem; }
            .lg\:p-8 { padding: 2rem; }
            .lg\:gap-4 { gap: 1rem; }
        }
        
        /* Extra large devices (large desktops, 1280px and up) */
        @media (min-width: 1280px) {
            .xl\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
            .xl\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
            .xl\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
            .xl\:text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
            .xl\:p-6 { padding: 1.5rem; }
            .xl\:gap-6 { gap: 1.5rem; }
        }
        
        /* 2X large devices (larger desktops, 1536px and up) */
        @media (min-width: 1536px) {
            .\32xl\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
            .\32xl\:text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
            .\32xl\:p-8 { padding: 2rem; }
        }
        
        /* Landscape orientation optimization for mobile devices */
        @media (max-width: 768px) and (orientation: landscape) {
            .header-height { height: 48px; }
            .header-spacing { padding-top: 48px; }
            .sidebar-position { top: 48px; height: calc(100vh - 48px); }
            #pdfCanvasContainer { height: calc(100vh - 10rem); }
        }

        /* Custom scrollbar styling */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Active sidebar item */
        .sidebar-item.active { background-color: #3b82f6; color: white; }
        .sidebar-item.active span { color: white; }
        .sidebar-item.active svg { color: white; }
        
        /* Folder expansion animation */
        .folder-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .folder-content.expanded { max-height: 5000px; }
        
        /* PDF container - responsive heights */
        .pdf-iframe-container {
            background: #525659;
            min-height: calc(100vh - 10rem);
            border-radius: 0 0 0.5rem 0.5rem;
            overflow: auto;
            position: relative;
        }
        
        .pdf-iframe-container iframe,
        .pdf-iframe-container object {
            width: 100%;
            height: calc(100vh - 10rem);
            border: none;
            border-radius: 0 0 0.5rem 0.5rem;
        }
        
        /* PDF.js canvas rendering container */
        #pdfCanvasContainer {
            width: 100%;
            height: calc(100vh - 10rem);
            overflow: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            gap: 1rem;
        }
        
        .pdf-page-canvas {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            background: white;
            /* Enable hardware acceleration for better performance */
            will-change: transform;
            max-width: 100%;
            height: auto;
        }
        
        @media (max-width: 768px) {
            .pdf-iframe-container {
                min-height: calc(100vh - 14rem);
            }
            .pdf-iframe-container iframe,
            .pdf-iframe-container object {
                height: calc(100vh - 14rem);
            }
            #pdfCanvasContainer {
                height: calc(100vh - 14rem);
                padding: 0.5rem;
            }
        }
        
        /* Fullscreen mode styles */
        .pdf-iframe-container:fullscreen,
        .pdf-iframe-container:-webkit-full-screen,
        .pdf-iframe-container:-moz-full-screen,
        .pdf-iframe-container:-ms-fullscreen {
            width: 100vw !important;
            height: 100vh !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
            border-radius: 0 !important;
            background: #525659;
        }
        
        .pdf-iframe-container:fullscreen iframe,
        .pdf-iframe-container:fullscreen object,
        .pdf-iframe-container:-webkit-full-screen iframe,
        .pdf-iframe-container:-webkit-full-screen object {
            width: 100vw !important;
            height: 100vh !important;
            border-radius: 0 !important;
        }
        
        .pdf-iframe-container:fullscreen #pdfCanvasContainer,
        .pdf-iframe-container:-webkit-full-screen #pdfCanvasContainer {
            width: 100vw !important;
            height: 100vh !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
            padding: 0.25rem;
        }
        
        /* Hide controls when in fullscreen */
        .fullscreen-active .pdf-controls-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }
        
        .fullscreen-active .pdf-controls-wrapper:hover,
        .fullscreen-active .pdf-controls-wrapper.show-controls {
            transform: translateY(0);
        }
        
        /* Responsive sidebar width */
        .sidebar-responsive {
            width: 100%;
            max-width: 20rem;
        }
        
        @media (min-width: 480px) {
            .sidebar-responsive {
                width: 20rem;
            }
        }
        
        /* Loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Sidebar overlay */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 30;
        }
        
        /* Header height constants */
        .header-height { height: 56px; }
        .header-spacing { padding-top: 56px; }
        .sidebar-position { top: 56px; height: calc(100vh - 56px); }
        .main-min-height { min-height: calc(100vh - 56px); }
        .content-min-height { min-height: calc(100vh - 7rem); }
        
        /* Ensure proper height calculations */
        html, body { height: 100%; }
        
        /* Smooth scrolling */
        html { scroll-behavior: smooth; }
        
        /* Improve text rendering */
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Focus visible for accessibility */
        *:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* Prevent horizontal scroll on mobile */
        body {
            overflow-x: hidden;
        }
        
        /* Safe area insets for notched devices */
        @supports (padding: max(0px)) {
            header {
                padding-left: max(0.75rem, env(safe-area-inset-left));
                padding-right: max(0.75rem, env(safe-area-inset-right));
            }
            .sidebar-responsive {
                padding-left: max(0, env(safe-area-inset-left));
            }
        }
        
        /* Dark mode styles */
        body.dark-mode {
            background-color: #111827;
            color: #f3f4f6;
        }
        
        body.dark-mode .bg-white { background-color: #1f2937; }
        body.dark-mode .bg-gray-100 { background-color: #111827; }
        body.dark-mode .bg-gray-200 { background-color: #374151; }
        body.dark-mode .text-gray-600 { color: #d1d5db; }
        body.dark-mode .text-gray-700 { color: #e5e7eb; }
        body.dark-mode .text-gray-800 { color: #f3f4f6; }
        body.dark-mode .text-gray-500 { color: #9ca3af; }
        body.dark-mode .border-gray-200 { border-color: #374151; }
        body.dark-mode .hover\:bg-gray-100:hover { background-color: #374151; }
        body.dark-mode .hover\:bg-gray-300:hover { background-color: #4b5563; }
        body.dark-mode .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3); }
        body.dark-mode .pdf-iframe-container { background: #1f2937; }
        body.dark-mode input {
            background-color: #374151;
            border-color: #4b5563;
            color: #f3f4f6;
        }
        body.dark-mode input::placeholder {
            color: #9ca3af;
        }
        body.dark-mode input:focus {
            background-color: #4b5563;
        }
        
        /* Toast notification styles */
        .toast-container {
            position: fixed;
            bottom: 5rem;
            right: 1rem;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .toast {
            background-color: #1f2937;
            color: #ffffff;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideIn 0.3s ease-out;
            max-width: 300px;
        }
        
        .toast.success { background-color: #059669; }
        .toast.error { background-color: #dc2626; }
        .toast.info { background-color: #2563eb; }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .toast.fade-out {
            animation: slideOut 0.3s ease-out forwards;
        }
        
        /* Scroll to top button */
        .scroll-to-top {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 60;
            background-color: #2563eb;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgb(0 0 0 / 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .scroll-to-top:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }
        
        .scroll-to-top.visible {
            display: flex;
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background-color: #ffffff;
            border-radius: 0.75rem;
            max-width: 32rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            animation: modalFadeIn 0.2s ease-out;
        }
        
        body.dark-mode .modal-content {
            background-color: #1f2937;
        }
        
        @keyframes modalFadeIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        /* Footer styles */
        .footer {
            background-color: #1f2937;
            color: #9ca3af;
            padding: 1.5rem 1rem;
            margin-top: auto;
            width: 100%;
        }
        
        @media (max-width: 640px) {
            .footer {
                padding: 1.25rem 1rem;
            }
            
            .footer .flex.flex-wrap {
                flex-direction: column;
                align-items: center;
            }
        }
        
        .footer a {
            color: #60a5fa;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .footer a:hover {
            color: #93c5fd;
        }
        
        /* Sidebar section styles */
        .sidebar-section {
            border-top: 1px solid #e5e7eb;
            padding-top: 0.75rem;
            margin-top: 0.75rem;
        }
        
        body.dark-mode .sidebar-section {
            border-color: #374151;
        }
        
        .sidebar-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .sidebar-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        body.dark-mode .sidebar-section-title {
            color: #9ca3af;
        }
        
        /* Skip to content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #2563eb;
            color: white;
            padding: 8px 16px;
            z-index: 1000;
            text-decoration: none;
            border-radius: 0 0 4px 0;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        /* Keyboard shortcut styling */
        .kbd {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
            background-color: #e5e7eb;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            box-shadow: 0 1px 2px rgb(0 0 0 / 0.1);
        }
        
        body.dark-mode .kbd {
            background-color: #374151;
            border-color: #4b5563;
            color: #e5e7eb;
        }
        
        /* File statistics badge */
        .stats-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background-color: #dbeafe;
            color: #1e40af;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        body.dark-mode .stats-badge {
            background-color: #1e3a5f;
            color: #93c5fd;
        }
        
        /* Folder action buttons */
        .folder-actions {
            display: flex;
            gap: 0.25rem;
        }
        
        .folder-action-btn {
            padding: 0.25rem;
            border-radius: 0.25rem;
            color: #6b7280;
            transition: all 0.2s;
        }
        
        .folder-action-btn:hover {
            background-color: #e5e7eb;
            color: #374151;
        }
        
        body.dark-mode .folder-action-btn:hover {
            background-color: #374151;
            color: #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to content</a>
    
    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-lg fixed w-full z-50 header-height">
        <div class="px-3 sm:px-4 py-2 sm:py-3 flex items-center justify-between h-full">
            <h1 class="text-base sm:text-lg md:text-xl lg:text-2xl font-bold flex items-center gap-1 sm:gap-2 min-w-0">
                <img src="https://res.cloudinary.com/dkj22lm1g/image/upload/w_40,h_40,c_fill/v1768415117/BIT_Repository_xropb0.jpg" alt="BIT Repository Logo" class="h-7 w-7 sm:h-10 sm:w-10 rounded-lg flex-shrink-0 object-cover">
                <span class="truncate text-sm sm:text-base md:text-lg lg:text-xl">BIT Repository</span>
                <span class="hidden sm:inline truncate text-sm md:text-base lg:text-lg"> - PDF Viewer</span>
            </h1>
            <div class="flex items-center gap-1 sm:gap-2">
                <!-- Help/Keyboard Shortcuts -->
                <button id="helpButton" class="bg-blue-700 hover:bg-blue-800 px-2 sm:px-3 py-2 rounded flex-shrink-0 transition-colors" aria-label="Help and keyboard shortcuts" title="Help (Press ?)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </button>
                <!-- Dark Mode Toggle -->
                <button id="darkModeToggle" class="bg-blue-700 hover:bg-blue-800 px-2 sm:px-3 py-2 rounded flex-shrink-0 transition-colors" aria-label="Toggle dark mode" title="Toggle dark mode">
                    <svg id="darkModeIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
                <!-- Sidebar Toggle -->
                <button id="toggleSidebar" class="lg:hidden bg-blue-700 hover:bg-blue-800 px-2 sm:px-3 py-2 rounded flex-shrink-0 transition-colors" aria-label="Toggle sidebar" title="Toggle sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div class="flex flex-1 header-spacing">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar-responsive sidebar-position bg-white shadow-lg fixed overflow-y-auto transition-all duration-300 z-40 -translate-x-full lg:translate-x-0">
            <div class="p-3 sm:p-4">
                <h2 class="text-sm sm:text-base lg:text-lg font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                    </svg>
                    <span>PDF Files</span>
                </h2>
                
                <!-- Search Bar -->
                <div class="mb-3 sm:mb-4 relative">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Search PDFs..." 
                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        aria-label="Search PDF files"
                    />
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-400 absolute right-3 top-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                
                <!-- File Statistics and Folder Controls -->
                <div class="flex items-center justify-between mb-3">
                    <span id="fileStats" class="stats-badge">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <span id="fileCount">0 files</span>
                    </span>
                    <div class="folder-actions">
                        <button id="expandAllBtn" class="folder-action-btn" title="Expand all folders" aria-label="Expand all folders">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                            </svg>
                        </button>
                        <button id="collapseAllBtn" class="folder-action-btn" title="Collapse all folders" aria-label="Collapse all folders">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Favorites Section -->
                <div id="favoritesSection" class="sidebar-section hidden">
                    <div class="sidebar-section-header">
                        <span class="sidebar-section-title">‚≠ê Favorites</span>
                        <button id="clearFavorites" class="text-xs text-gray-400 hover:text-red-500 transition-colors" title="Clear all favorites">Clear</button>
                    </div>
                    <div id="favoritesList" class="space-y-1 max-h-32 overflow-y-auto">
                        <!-- Favorites will be populated dynamically -->
                    </div>
                </div>
                
                <!-- Recently Viewed Section -->
                <div id="recentSection" class="sidebar-section hidden">
                    <div class="sidebar-section-header">
                        <span class="sidebar-section-title">üïê Recently Viewed</span>
                        <button id="clearRecent" class="text-xs text-gray-400 hover:text-red-500 transition-colors" title="Clear history">Clear</button>
                    </div>
                    <div id="recentList" class="space-y-1 max-h-32 overflow-y-auto">
                        <!-- Recent files will be populated dynamically -->
                    </div>
                </div>
                
                <!-- All Files Section -->
                <div class="sidebar-section">
                    <div class="sidebar-section-header">
                        <span class="sidebar-section-title">üìÅ All Files</span>
                    </div>
                    <div id="fileTree" class="space-y-2">
                        <!-- File tree will be dynamically populated by buildFileTree() function -->
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 lg:ml-80 p-2 sm:p-3 md:p-4 flex flex-col">
            <!-- Welcome Message -->
            <div id="welcomeMessage" class="flex flex-col items-center justify-center text-center flex-1">
                <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 max-w-md mx-4">
                    <img src="https://res.cloudinary.com/dkj22lm1g/image/upload/w_192,h_192,c_fill/v1768415117/BIT_Repository_xropb0.jpg" alt="BIT Repository Logo" class="h-20 w-20 sm:h-24 sm:w-24 mx-auto rounded-xl shadow-md mb-4 object-cover">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3">Welcome to BIT Repository</h2>
                    <p class="text-base text-gray-600 mb-4">Select a PDF file from the sidebar to start viewing.</p>
                    <p class="text-sm text-gray-500 mb-4">This repository contains course materials for the Bachelor of Information Technology program.</p>
                    <div class="flex flex-col gap-2 sm:gap-3 justify-center w-full max-w-xs">
                        <button onclick="document.getElementById('toggleSidebar').click()" class="lg:hidden bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors w-full">
                            Browse Files
                        </button>
                        <button onclick="openHelpModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors w-full">
                            View Help
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="hidden flex-col items-center justify-center flex-1">
                <div class="bg-white rounded-xl shadow-lg p-8 max-w-sm mx-4">
                    <img src="https://res.cloudinary.com/dkj22lm1g/image/upload/w_80,h_80,c_fill/v1768415117/BIT_Repository_xropb0.jpg" alt="BIT Repository Logo - Loading" class="h-16 w-16 mx-auto rounded-lg mb-4 object-cover animate-pulse">
                    <div class="loader mb-4 mx-auto"></div>
                    <p class="text-base text-gray-700 font-medium">Loading PDF...</p>
                    <p class="text-sm text-gray-500 mt-2">Please wait while we prepare your document</p>
                </div>
            </div>

            <!-- PDF Viewer Container -->
            <div id="pdfContainer" class="hidden">
                <!-- Breadcrumb Navigation -->
                <nav class="mb-2 sm:mb-3" aria-label="Breadcrumb">
                    <ol id="breadcrumb" class="flex items-center flex-wrap gap-1 text-xs sm:text-sm text-gray-600">
                        <li class="flex items-center">
                            <a href="#" class="hover:text-blue-600 transition-colors" onclick="event.preventDefault();">Home</a>
                        </li>
                    </ol>
                </nav>
                
                <!-- PDF Controls Wrapper -->
                <div class="pdf-controls-wrapper">
                    <!-- PDF Controls -->
                    <div class="bg-white rounded-t-lg shadow-lg p-2 sm:p-3 md:p-4 sticky top-14 z-30">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3 md:gap-4">
                            <div class="flex items-center gap-2 min-w-0 flex-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-red-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <h3 id="pdfTitle" class="text-sm sm:text-base md:text-lg font-semibold text-gray-700 truncate"></h3>
                                <button id="favoritePdf" class="flex-shrink-0 text-gray-400 hover:text-yellow-500 transition-colors" aria-label="Add to favorites" title="Add to favorites">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                                    </svg>
                                </button>
                            </div>
                            <div class="flex items-center gap-2 flex-wrap">
                                <!-- Zoom Controls -->
                                <div class="hidden sm:flex items-center gap-1 bg-gray-100 rounded px-2 py-1">
                                    <button id="zoomOut" class="hover:bg-gray-200 p-1 rounded transition-colors" aria-label="Zoom out" title="Zoom out">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7" />
                                        </svg>
                                    </button>
                                    <span id="zoomLevel" class="text-xs font-medium min-w-[3rem] text-center">100%</span>
                                    <button id="zoomIn" class="hover:bg-gray-200 p-1 rounded transition-colors" aria-label="Zoom in" title="Zoom in">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <!-- Print Button -->
                                <button id="printPdf" class="bg-gray-200 hover:bg-gray-300 px-2 sm:px-3 py-1.5 sm:py-2 rounded flex items-center gap-1 transition-all text-gray-700 text-xs sm:text-sm" aria-label="Print PDF" title="Print PDF">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                                    </svg>
                                    <span class="hidden md:inline">Print</span>
                                </button>
                                
                                <!-- Copy Link Button -->
                                <button id="copyLinkBtn" class="bg-gray-200 hover:bg-gray-300 px-2 sm:px-3 py-1.5 sm:py-2 rounded flex items-center gap-1 transition-all text-gray-700 text-xs sm:text-sm" aria-label="Copy link to clipboard" title="Copy link to clipboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                                    </svg>
                                    <span class="hidden md:inline">Copy Link</span>
                                </button>
                                
                                <!-- Fullscreen Toggle -->
                                <button id="fullscreenToggle" class="bg-gray-200 hover:bg-gray-300 px-2 sm:px-3 py-1.5 sm:py-2 rounded flex items-center gap-1 transition-all text-gray-700 text-xs sm:text-sm" aria-label="Toggle fullscreen" title="Toggle fullscreen">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                                    </svg>
                                    <span class="hidden md:inline">Fullscreen</span>
                                </button>
                                
                                <!-- Download Button -->
                                <a id="downloadPdf" href="#" download class="bg-blue-500 hover:bg-blue-600 text-white px-2 sm:px-3 md:px-4 py-1.5 sm:py-2 rounded flex items-center gap-1 sm:gap-2 transition-all text-xs sm:text-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                    </svg>
                                    <span class="hidden sm:inline">Download</span>
                                </a>
                                
                                <!-- Open in New Tab -->
                                <a id="openInNewTab" href="#" target="_blank" class="bg-gray-200 hover:bg-gray-300 px-2 sm:px-3 md:px-4 py-1.5 sm:py-2 rounded flex items-center gap-1 sm:gap-2 transition-all text-gray-700 text-xs sm:text-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                    </svg>
                                    <span class="hidden sm:inline">New Tab</span>
                                </a>
                            </div>
                        </div>
                        
                        <!-- Page Navigation for Canvas Mode -->
                        <div id="pageNavigation" class="hidden mt-2 sm:mt-3 flex items-center justify-center gap-2 border-t border-gray-200 pt-2 sm:pt-3">
                            <button id="prevPage" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded text-sm transition-colors" aria-label="Previous page">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <span id="pageInfo" class="text-sm text-gray-600">Page <span id="pageNum">1</span> of <span id="pageCount">1</span></span>
                            <button id="nextPage" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded text-sm transition-colors" aria-label="Next page">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- PDF Container -->
                <div id="pdfIframeContainer" class="pdf-iframe-container">
                    <!-- Native PDF viewer using object tag (works on desktop) -->
                    <object id="pdfViewer" type="application/pdf" width="100%" height="100%" style="min-height: calc(100vh - 10rem);">
                        <iframe id="pdfViewerFallback" title="PDF Viewer" width="100%" height="100%" style="min-height: calc(100vh - 10rem);"></iframe>
                    </object>
                    <!-- PDF.js canvas rendering for mobile devices -->
                    <div id="pdfCanvasContainer" class="hidden"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer lg:ml-80">
        <div class="max-w-4xl mx-auto text-center">
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-4">
                <div class="flex items-center gap-2">
                    <img src="https://res.cloudinary.com/dkj22lm1g/image/upload/w_40,h_40,c_fill/v1768415117/BIT_Repository_xropb0.jpg" alt="BIT Repository Logo" class="h-8 w-8 rounded-lg object-cover">
                    <span class="font-semibold text-white">BIT Repository</span>
                </div>
                <div class="hidden sm:block text-gray-600">|</div>
                <p class="text-sm">Bachelor of Information Technology Course Materials</p>
            </div>
            <div class="flex flex-wrap items-center justify-center gap-4 mb-4 text-sm">
                <a href="https://github.com/AshenWijesingha/BIT" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                    GitHub
                </a>
                <button onclick="openHelpModal()" class="flex items-center gap-1 hover:text-blue-400 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Help
                </button>
                <span class="flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Press <kbd class="kbd text-xs mx-1">?</kbd> for shortcuts
                </span>
            </div>
            <div class="text-xs text-gray-500 border-t border-gray-700 pt-4">
                <p>¬© 2024 BIT Repository. Educational materials for the BIT program.</p>
                <p class="mt-1">Made with ‚ù§Ô∏è for students</p>
            </div>
        </div>
    </footer>

    <!-- Scroll to Top Button -->
    <button id="scrollToTop" class="scroll-to-top" aria-label="Scroll to top" title="Scroll to top">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container" aria-live="polite"></div>

    <!-- Help/Keyboard Shortcuts Modal -->
    <div id="helpModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
        <div class="modal-content">
            <div class="p-4 sm:p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="helpModalTitle" class="text-xl font-bold text-gray-800">Help & Keyboard Shortcuts</h2>
                    <button id="closeHelpModal" class="text-gray-400 hover:text-gray-600 transition-colors" aria-label="Close modal">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- About Section -->
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-2 flex items-center gap-2">
                            <img src="https://res.cloudinary.com/dkj22lm1g/image/upload/w_24,h_24,c_fill/v1768415117/BIT_Repository_xropb0.jpg" alt="BIT Repository Logo" class="h-5 w-5 rounded object-cover" role="presentation"> About BIT Repository
                        </h3>
                        <p class="text-sm text-gray-600">
                            This is a PDF repository for Bachelor of Information Technology (BIT) course materials. 
                            Browse, search, and view PDF files from various semesters and subjects.
                        </p>
                    </div>
                    
                    <!-- Keyboard Shortcuts -->
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                            <span>‚å®Ô∏è</span> Keyboard Shortcuts
                        </h3>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="flex items-center justify-between bg-gray-50 rounded p-2">
                                <span class="text-gray-600">Show help</span>
                                <kbd class="kbd">?</kbd>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 rounded p-2">
                                <span class="text-gray-600">Search files</span>
                                <div><kbd class="kbd">Ctrl</kbd> + <kbd class="kbd">F</kbd></div>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 rounded p-2">
                                <span class="text-gray-600">Zoom in</span>
                                <div><kbd class="kbd">Ctrl</kbd> + <kbd class="kbd">+</kbd></div>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 rounded p-2">
                                <span class="text-gray-600">Zoom out</span>
                                <div><kbd class="kbd">Ctrl</kbd> + <kbd class="kbd">-</kbd></div>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 rounded p-2">
                                <span class="text-gray-600">Reset zoom</span>
                                <div><kbd class="kbd">Ctrl</kbd> + <kbd class="kbd">0</kbd></div>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 rounded p-2">
                                <span class="text-gray-600">Previous page</span>
                                <kbd class="kbd">‚Üê</kbd>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 rounded p-2">
                                <span class="text-gray-600">Next page</span>
                                <kbd class="kbd">‚Üí</kbd>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 rounded p-2">
                                <span class="text-gray-600">Close modal</span>
                                <kbd class="kbd">Esc</kbd>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Features -->
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-2 flex items-center gap-2">
                            <span>‚ú®</span> Features
                        </h3>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li class="flex items-center gap-2"><span>üåô</span> Dark mode support</li>
                            <li class="flex items-center gap-2"><span>‚≠ê</span> Favorite PDFs for quick access</li>
                            <li class="flex items-center gap-2"><span>üîç</span> Search through all files</li>
                            <li class="flex items-center gap-2"><span>üì±</span> Mobile-responsive design</li>
                            <li class="flex items-center gap-2"><span>üîó</span> Share links to specific PDFs</li>
                            <li class="flex items-center gap-2"><span>üñ®Ô∏è</span> Print PDFs directly</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <button onclick="closeHelpModal()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                        Got it!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div id="sidebarOverlay" class="sidebar-overlay hidden lg:hidden"></div>

    <script>
        // Configure PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
        
        // Constants
        const PDF_LOAD_TIMEOUT_MS = 3000; // Fallback timeout for PDF loading
        const INDENT_SIZE_PX = 12; // Indentation for nested sidebar items
        const PDF_VIEW_MODE = '#view=FitH'; // Default PDF view mode
        const CANVAS_CONTAINER_PADDING = 32; // Padding for canvas container (2 * 1rem)
        const MIN_ZOOM = 0.5; // Minimum zoom level (50%)
        const MAX_ZOOM = 3.0; // Maximum zoom level (300%)
        const MAX_RECENT_FILES = 10; // Maximum number of recent files to track
        const TOAST_DURATION_MS = 3000; // Toast notification duration

        // PDF Files - loaded dynamically from files.json
        let pdfFiles = {};
        let totalFileCount = 0;

        // State variables
        let currentPdfPath = '';
        let pdfDoc = null;
        let usingCanvasRenderer = false;
        let currentZoom = 1.0;
        let currentPage = 1;
        let favorites = JSON.parse(localStorage.getItem('pdfFavorites') || '[]');
        let recentFiles = JSON.parse(localStorage.getItem('pdfRecentFiles') || '[]');
        let isDarkMode = localStorage.getItem('darkMode') === 'true';

        // DOM Elements
        const fileTree = document.getElementById('fileTree');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const pdfContainer = document.getElementById('pdfContainer');
        const pdfTitle = document.getElementById('pdfTitle');
        const downloadPdf = document.getElementById('downloadPdf');
        const openInNewTab = document.getElementById('openInNewTab');
        const pdfViewer = document.getElementById('pdfViewer');
        const pdfViewerFallback = document.getElementById('pdfViewerFallback');
        const pdfCanvasContainer = document.getElementById('pdfCanvasContainer');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const searchInput = document.getElementById('searchInput');
        const breadcrumb = document.getElementById('breadcrumb');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = document.getElementById('darkModeIcon');
        const favoritePdf = document.getElementById('favoritePdf');
        const fullscreenToggle = document.getElementById('fullscreenToggle');
        const zoomIn = document.getElementById('zoomIn');
        const zoomOut = document.getElementById('zoomOut');
        const zoomLevel = document.getElementById('zoomLevel');
        const pageNavigation = document.getElementById('pageNavigation');
        const prevPage = document.getElementById('prevPage');
        const nextPage = document.getElementById('nextPage');
        const pageNum = document.getElementById('pageNum');
        const pageCount = document.getElementById('pageCount');
        const scrollToTopBtn = document.getElementById('scrollToTop');
        const toastContainer = document.getElementById('toastContainer');
        const helpModal = document.getElementById('helpModal');
        const helpButton = document.getElementById('helpButton');
        const closeHelpModalBtn = document.getElementById('closeHelpModal');
        const expandAllBtn = document.getElementById('expandAllBtn');
        const collapseAllBtn = document.getElementById('collapseAllBtn');
        const fileCountEl = document.getElementById('fileCount');
        const favoritesSection = document.getElementById('favoritesSection');
        const favoritesList = document.getElementById('favoritesList');
        const recentSection = document.getElementById('recentSection');
        const recentList = document.getElementById('recentList');
        const clearFavoritesBtn = document.getElementById('clearFavorites');
        const clearRecentBtn = document.getElementById('clearRecent');
        const printPdfBtn = document.getElementById('printPdf');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        
        // Detect if device likely supports native PDF viewing
        function supportsNativePDFViewing() {
            // Mobile devices typically don't support inline PDF viewing
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            return !isMobile;
        }
        
        // Toast notification system
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    ${type === 'success' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />' :
                      type === 'error' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />' :
                      '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />'}
                </svg>
                <span class="text-sm">${message}</span>
            `;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => toast.remove(), 300);
            }, TOAST_DURATION_MS);
        }
        
        // Help modal functions
        function openHelpModal() {
            helpModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeHelpModal() {
            helpModal.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        helpButton.addEventListener('click', openHelpModal);
        closeHelpModalBtn.addEventListener('click', closeHelpModal);
        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) closeHelpModal();
        });
        
        // Scroll to top functionality
        function updateScrollToTopVisibility() {
            const scrollY = window.scrollY || document.documentElement.scrollTop;
            if (scrollY > 300) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        }
        
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        window.addEventListener('scroll', updateScrollToTopVisibility);
        
        // Expand/Collapse all folders
        expandAllBtn.addEventListener('click', () => {
            fileTree.querySelectorAll('.folder-content').forEach(content => {
                content.classList.add('expanded');
            });
            fileTree.querySelectorAll('.chevron').forEach(chevron => {
                chevron.classList.add('rotate-90');
            });
            showToast('All folders expanded', 'info');
        });
        
        collapseAllBtn.addEventListener('click', () => {
            fileTree.querySelectorAll('.folder-content').forEach(content => {
                content.classList.remove('expanded');
            });
            fileTree.querySelectorAll('.chevron').forEach(chevron => {
                chevron.classList.remove('rotate-90');
            });
            showToast('All folders collapsed', 'info');
        });
        
        // Update favorites section in sidebar
        function updateFavoritesSection() {
            if (favorites.length === 0) {
                favoritesSection.classList.add('hidden');
                return;
            }
            
            favoritesSection.classList.remove('hidden');
            favoritesList.innerHTML = '';
            
            favorites.forEach(filePath => {
                const fileName = filePath.split('/').pop().replace('.pdf', '');
                const item = document.createElement('div');
                item.className = 'flex items-center gap-2 p-1.5 rounded cursor-pointer hover:bg-gray-100 transition-colors text-sm';
                item.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                    <span class="truncate text-gray-600" title="${fileName}">${fileName}</span>
                `;
                item.addEventListener('click', () => loadPdf(filePath));
                favoritesList.appendChild(item);
            });
        }
        
        // Update recent files section in sidebar
        function updateRecentSection() {
            if (recentFiles.length === 0) {
                recentSection.classList.add('hidden');
                return;
            }
            
            recentSection.classList.remove('hidden');
            recentList.innerHTML = '';
            
            recentFiles.slice(0, 5).forEach(filePath => {
                const fileName = filePath.split('/').pop().replace('.pdf', '');
                const item = document.createElement('div');
                item.className = 'flex items-center gap-2 p-1.5 rounded cursor-pointer hover:bg-gray-100 transition-colors text-sm';
                item.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="truncate text-gray-600" title="${fileName}">${fileName}</span>
                `;
                item.addEventListener('click', () => loadPdf(filePath));
                recentList.appendChild(item);
            });
        }
        
        // Clear favorites
        clearFavoritesBtn.addEventListener('click', () => {
            favorites = [];
            localStorage.setItem('pdfFavorites', JSON.stringify(favorites));
            updateFavoritesSection();
            showToast('Favorites cleared', 'success');
        });
        
        // Clear recent files
        clearRecentBtn.addEventListener('click', () => {
            recentFiles = [];
            localStorage.setItem('pdfRecentFiles', JSON.stringify(recentFiles));
            updateRecentSection();
            showToast('History cleared', 'success');
        });
        
        // Print PDF
        printPdfBtn.addEventListener('click', () => {
            if (currentPdfPath && isValidPdfPath(currentPdfPath)) {
                const printWindow = window.open(encodeURI(currentPdfPath), '_blank');
                if (printWindow) {
                    printWindow.onload = () => {
                        printWindow.print();
                    };
                    showToast('Opening print dialog...', 'info');
                }
            }
        });
        
        // Copy link to clipboard
        copyLinkBtn.addEventListener('click', async () => {
            if (currentPdfPath && isValidPdfPath(currentPdfPath)) {
                const url = window.location.origin + window.location.pathname + '?pdf=' + encodeURIComponent(currentPdfPath);
                try {
                    await navigator.clipboard.writeText(url);
                    showToast('Link copied to clipboard!', 'success');
                } catch (err) {
                    // Fallback for older browsers that don't support Clipboard API
                    // Note: document.execCommand('copy') is deprecated but still needed for legacy browser support
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showToast('Link copied to clipboard!', 'success');
                }
            }
        });
        
        // Count files helper function
        function countFilesInStructure(obj) {
            let count = 0;
            if (Array.isArray(obj)) {
                return obj.length;
            }
            for (const value of Object.values(obj)) {
                if (Array.isArray(value)) {
                    count += value.length;
                } else if (typeof value === 'object') {
                    count += countFilesInStructure(value);
                }
            }
            return count;
        }
        
        // Validate PDF path to prevent XSS attacks
        function isValidPdfPath(path) {
            // Check if path ends with .pdf and doesn't contain malicious characters
            if (!path || typeof path !== 'string') return false;
            if (!path.toLowerCase().endsWith('.pdf')) return false;
            // Prevent path traversal and protocol injection
            if (path.includes('..') || path.includes('://') || path.startsWith('/')) return false;
            // Check if path exists in file structure
            return getAllPdfPaths(pdfFiles).includes(path);
        }
        
        // Get all PDF paths from file structure
        function getAllPdfPaths(obj, paths = []) {
            if (Array.isArray(obj)) {
                paths.push(...obj);
            } else if (typeof obj === 'object') {
                for (const value of Object.values(obj)) {
                    getAllPdfPaths(value, paths);
                }
            }
            return paths;
        }
        
        // Helper function to hide loading indicator
        function hideLoadingIndicator() {
            loadingIndicator.classList.add('hidden');
            loadingIndicator.style.display = '';
        }
        
        // Helper function to show loading indicator
        function showLoadingIndicator() {
            welcomeMessage.classList.add('hidden');
            pdfContainer.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            loadingIndicator.style.display = 'flex';
        }

        // Load file structure from JSON
        async function loadFileStructure() {
            try {
                const response = await fetch('files.json');
                if (!response.ok) {
                    throw new Error('Failed to load file structure');
                }
                pdfFiles = await response.json();
                totalFileCount = countFilesInStructure(pdfFiles);
                fileCountEl.textContent = totalFileCount + (totalFileCount === 1 ? ' file' : ' files');
                buildFileTree();
                updateFavoritesSection();
                updateRecentSection();
                
                // Check for URL parameter to load specific PDF
                const urlParams = new URLSearchParams(window.location.search);
                const pdfParam = urlParams.get('pdf');
                if (pdfParam) {
                    // Validate that the PDF path exists in the file structure
                    const decodedPath = decodeURIComponent(pdfParam);
                    if (isValidPdfPath(decodedPath)) {
                        loadPdf(decodedPath);
                    }
                }
            } catch (error) {
                console.error('Error loading file structure:', error);
                // Show error message to user
                fileTree.innerHTML = `
                    <div class="p-4 text-center text-red-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p class="text-sm font-medium">Failed to load file list</p>
                        <p class="text-xs mt-1">Please refresh the page</p>
                    </div>
                `;
            }
        }

        // Build file tree
        function buildFileTree() {
            fileTree.innerHTML = '';
            
            if (Object.keys(pdfFiles).length === 0) {
                fileTree.innerHTML = `
                    <div class="p-4 text-center text-gray-500">
                        <p class="text-sm">Loading files...</p>
                    </div>
                `;
                return;
            }
            
            for (const [folder, content] of Object.entries(pdfFiles)) {
                const folderElement = createFolderElement(folder, content);
                fileTree.appendChild(folderElement);
            }
        }

        function createFolderElement(name, content, level = 0) {
            const container = document.createElement('div');
            container.className = 'folder-container';
            
            // Folder header - responsive margin calculation with better touch targets
            const header = document.createElement('div');
            header.className = 'flex items-center gap-1 sm:gap-2 p-2 rounded cursor-pointer hover:bg-gray-100 transition-colors';
            header.style.marginLeft = (level * INDENT_SIZE_PX) + 'px';
            header.style.minHeight = '44px'; // Touch target size
            header.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                </svg>
                <span class="text-sm font-medium text-gray-700 flex-1 truncate" title="${name}">${name}</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 chevron transition-transform flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            `;
            
            // Folder content
            const contentDiv = document.createElement('div');
            contentDiv.className = 'folder-content';
            
            if (Array.isArray(content)) {
                // Simple array of files
                content.forEach(file => {
                    const fileElement = createFileElement(file, level + 1);
                    contentDiv.appendChild(fileElement);
                });
            } else {
                // Object with subfolders and _root files
                if (content._root) {
                    content._root.forEach(file => {
                        const fileElement = createFileElement(file, level + 1);
                        contentDiv.appendChild(fileElement);
                    });
                }
                
                // Subfolders
                for (const [subFolder, subContent] of Object.entries(content)) {
                    if (subFolder !== '_root') {
                        const subFolderElement = createFolderElement(subFolder, subContent, level + 1);
                        contentDiv.appendChild(subFolderElement);
                    }
                }
            }
            
            // Toggle folder expansion
            header.addEventListener('click', () => {
                contentDiv.classList.toggle('expanded');
                header.querySelector('.chevron').classList.toggle('rotate-90');
            });
            
            container.appendChild(header);
            container.appendChild(contentDiv);
            
            return container;
        }

        function createFileElement(filePath, level) {
            const fileName = filePath.split('/').pop().replace('.pdf', '');
            const element = document.createElement('div');
            element.className = 'sidebar-item flex items-center gap-1 sm:gap-2 p-2 rounded cursor-pointer hover:bg-gray-100 transition-colors';
            element.style.marginLeft = (level * INDENT_SIZE_PX) + 'px';
            element.style.minHeight = '44px'; // Touch target size
            element.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <span class="text-sm text-gray-600 truncate" title="${fileName}">${fileName}</span>
            `;
            element.dataset.path = filePath;
            element.addEventListener('click', () => loadPdf(filePath));
            return element;
        }

        // Render PDF using PDF.js for mobile devices
        async function renderPDFWithCanvas(pdfPath) {
            try {
                // Clean up previous PDF document if exists
                if (pdfDoc) {
                    await pdfDoc.destroy();
                    pdfDoc = null;
                }
                
                pdfCanvasContainer.innerHTML = '<p class="text-white text-center">Loading PDF...</p>';
                
                // Load PDF document with high-quality rendering options
                const loadingTask = pdfjsLib.getDocument({
                    url: pdfPath,
                    // Enable high-quality rendering options
                    disableAutoFetch: false,
                    enableXfa: true
                });
                pdfDoc = await loadingTask.promise;
                
                // Clear container
                pdfCanvasContainer.innerHTML = '';
                
                // Show page navigation
                pageNavigation.classList.remove('hidden');
                pageCount.textContent = pdfDoc.numPages;
                currentPage = 1;
                updatePageDisplay();
                
                // Get container dimensions for proper scaling
                const container = pdfCanvasContainer;
                const containerRect = container.getBoundingClientRect();
                const containerWidth = containerRect.width > 0 ? containerRect.width : window.innerWidth;
                const containerPadding = window.innerWidth <= 768 ? 16 : CANVAS_CONTAINER_PADDING;
                const availableWidth = Math.max(containerWidth - containerPadding, 300);
                
                // Get device pixel ratio for high-DPI displays (limit to 2 for performance on mobile)
                const devicePixelRatio = Math.min(window.devicePixelRatio || 1, 2);
                
                // Render all pages
                for (let pageNum = 1; pageNum <= pdfDoc.numPages; pageNum++) {
                    const page = await pdfDoc.getPage(pageNum);
                    
                    // Create canvas
                    const canvas = document.createElement('canvas');
                    canvas.className = 'pdf-page-canvas';
                    canvas.dataset.pageNum = pageNum;
                    const context = canvas.getContext('2d', { alpha: false });
                    
                    // Calculate scale to fit screen width with zoom
                    const viewport = page.getViewport({ scale: 1 });
                    const scale = (availableWidth / viewport.width) * currentZoom;
                    
                    // Apply device pixel ratio for high-quality rendering on high-DPI displays
                    const outputScale = devicePixelRatio;
                    const scaledViewport = page.getViewport({ scale: scale * outputScale });
                    
                    // Set canvas dimensions to match the scaled viewport
                    canvas.width = scaledViewport.width;
                    canvas.height = scaledViewport.height;
                    
                    // Set CSS dimensions to display at correct size
                    canvas.style.width = Math.round(scaledViewport.width / outputScale) + 'px';
                    canvas.style.height = Math.round(scaledViewport.height / outputScale) + 'px';
                    
                    // Configure canvas context for high-quality rendering
                    context.imageSmoothingEnabled = true;
                    context.imageSmoothingQuality = 'high';
                    
                    // Render page with high-quality settings
                    await page.render({
                        canvasContext: context,
                        viewport: scaledViewport,
                        intent: 'display',
                        renderInteractiveForms: true
                    }).promise;
                    
                    pdfCanvasContainer.appendChild(canvas);
                }
                
                // Hide loading and show container
                hideLoadingIndicator();
                pdfContainer.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error rendering PDF:', error);
                hideLoadingIndicator();
                welcomeMessage.classList.remove('hidden');
                showToast('Error loading PDF. Try "Open in New Tab" or download the file.', 'error');
            }
        }

        // Load and display PDF using object tag with iframe fallback or PDF.js canvas
        async function loadPdf(pdfPath) {
            // Update active state in sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.path === pdfPath) {
                    item.classList.add('active');
                }
            });
            
            // Show loading
            showLoadingIndicator();
            
            // Close sidebar on mobile
            closeSidebar();
            
            currentPdfPath = pdfPath;
            const encodedPath = encodeURI(pdfPath);
            const fileName = pdfPath.split('/').pop();
            
            // Update UI
            pdfTitle.textContent = fileName;
            downloadPdf.href = encodedPath;
            downloadPdf.download = fileName;
            openInNewTab.href = encodedPath;
            
            // Update breadcrumb
            updateBreadcrumb(pdfPath);
            
            // Update favorite button
            if (favorites.includes(pdfPath)) {
                favoritePdf.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>';
                favoritePdf.classList.remove('text-gray-400');
                favoritePdf.classList.add('text-yellow-500');
            } else {
                favoritePdf.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>';
                favoritePdf.classList.remove('text-yellow-500');
                favoritePdf.classList.add('text-gray-400');
            }
            
            // Add to recent files
            addToRecentFiles(pdfPath);
            
            // Reset zoom
            currentZoom = 1.0;
            zoomLevel.textContent = '100%';
            
            // Check if we should use PDF.js canvas rendering (for mobile)
            const usePDFjs = typeof pdfjsLib !== 'undefined' && !supportsNativePDFViewing();
            usingCanvasRenderer = usePDFjs;
            
            if (usePDFjs) {
                // Use PDF.js canvas rendering for mobile devices
                pdfViewer.classList.add('hidden');
                pdfViewerFallback.classList.add('hidden');
                pdfCanvasContainer.classList.remove('hidden');
                
                await renderPDFWithCanvas(encodedPath);
            } else {
                // Use native PDF viewing for desktop
                // Clean up PDF.js document if switching from canvas mode
                if (pdfDoc) {
                    pdfDoc.destroy().catch(() => {}); // Ignore errors
                    pdfDoc = null;
                }
                
                // Hide page navigation for native mode
                pageNavigation.classList.add('hidden');
                
                pdfViewer.classList.remove('hidden');
                pdfCanvasContainer.classList.add('hidden');
                
                // Set PDF URL with view parameters for better display
                const pdfUrl = encodedPath + PDF_VIEW_MODE;
                
                // Load PDF using object tag (better mobile support)
                pdfViewer.onload = function() {
                    hideLoadingIndicator();
                    pdfContainer.classList.remove('hidden');
                };
                
                pdfViewer.onerror = function() {
                    hideLoadingIndicator();
                    welcomeMessage.classList.remove('hidden');
                    alert('Error loading PDF file. Please try again or use the "Open in New Tab" option.');
                };
                
                // Set the data attribute on object tag for PDF
                pdfViewer.setAttribute('data', pdfUrl);
                
                // Also set the fallback iframe source
                pdfViewerFallback.src = pdfUrl;
                
                // Fallback timeout in case onload doesn't fire
                setTimeout(() => {
                    if (loadingIndicator.style.display === 'flex') {
                        hideLoadingIndicator();
                        pdfContainer.classList.remove('hidden');
                    }
                }, PDF_LOAD_TIMEOUT_MS);
            }
        }

        // Sidebar toggle for mobile
        document.getElementById('toggleSidebar').addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        });

        sidebarOverlay.addEventListener('click', closeSidebar);

        function closeSidebar() {
            if (window.innerWidth < 1024) {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            }
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            }
            
            // Re-render PDF if using canvas mode and zoom is active
            if (usingCanvasRenderer && pdfDoc && currentZoom !== 1.0) {
                renderPDFWithCanvas(currentPdfPath);
            }
        });
        
        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            const allItems = fileTree.querySelectorAll('.sidebar-item, .folder-container');
            
            if (searchTerm === '') {
                // Show all items
                allItems.forEach(item => {
                    item.style.display = '';
                });
                // Collapse all folders
                fileTree.querySelectorAll('.folder-content').forEach(content => {
                    content.classList.remove('expanded');
                });
                fileTree.querySelectorAll('.chevron').forEach(chevron => {
                    chevron.classList.remove('rotate-90');
                });
            } else {
                // Hide all items first
                allItems.forEach(item => {
                    item.style.display = 'none';
                });
                
                // Show matching items and their parents
                const items = fileTree.querySelectorAll('.sidebar-item');
                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        item.style.display = '';
                        
                        // Show parent folders
                        let parent = item.parentElement;
                        while (parent && parent !== fileTree) {
                            parent.style.display = '';
                            if (parent.classList.contains('folder-content')) {
                                parent.classList.add('expanded');
                                const header = parent.previousElementSibling;
                                if (header) {
                                    const chevron = header.querySelector('.chevron');
                                    if (chevron) chevron.classList.add('rotate-90');
                                }
                            }
                            parent = parent.parentElement;
                        }
                    }
                });
            }
        });
        
        // Dark mode toggle
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            localStorage.setItem('darkMode', isDarkMode);
            
            // Update icon
            if (isDarkMode) {
                darkModeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />';
            } else {
                darkModeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />';
            }
        }
        
        darkModeToggle.addEventListener('click', toggleDarkMode);
        
        // Favorites functionality
        function toggleFavorite() {
            if (!currentPdfPath) return;
            
            const index = favorites.indexOf(currentPdfPath);
            if (index > -1) {
                favorites.splice(index, 1);
                favoritePdf.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>';
                favoritePdf.classList.remove('text-yellow-500');
                favoritePdf.classList.add('text-gray-400');
                showToast('Removed from favorites', 'info');
            } else {
                favorites.push(currentPdfPath);
                favoritePdf.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>';
                favoritePdf.classList.remove('text-gray-400');
                favoritePdf.classList.add('text-yellow-500');
                showToast('Added to favorites', 'success');
            }
            
            localStorage.setItem('pdfFavorites', JSON.stringify(favorites));
            updateFavoritesSection();
        }
        
        favoritePdf.addEventListener('click', toggleFavorite);
        
        // Helper function to collapse all folders in the sidebar
        function collapseAllFolders() {
            fileTree.querySelectorAll('.folder-content').forEach(content => {
                content.classList.remove('expanded');
            });
            fileTree.querySelectorAll('.chevron').forEach(chevron => {
                chevron.classList.remove('rotate-90');
            });
        }
        
        // Navigate to folder in sidebar
        function navigateToFolder(folderPath) {
            // Split path into parts
            const parts = folderPath.split('/');
            
            // Collapse all folders first
            collapseAllFolders();
            
            // Find and expand each folder in the path
            let currentElement = fileTree;
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i];
                const folderContainers = currentElement.querySelectorAll(':scope > .folder-container');
                
                let foundFolder = false;
                for (const container of folderContainers) {
                    const header = container.querySelector(':scope > div');
                    if (!header) continue;
                    
                    const folderName = header.querySelector('span')?.textContent?.trim();
                    
                    if (folderName === part) {
                        // Expand this folder
                        const content = container.querySelector('.folder-content');
                        const chevron = header.querySelector('.chevron');
                        if (content) {
                            content.classList.add('expanded');
                        }
                        if (chevron) {
                            chevron.classList.add('rotate-90');
                        }
                        
                        // Scroll the folder header into view
                        header.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                        // Move to this folder's content for next iteration
                        if (content) {
                            currentElement = content;
                            foundFolder = true;
                        }
                        break;
                    }
                }
                
                // If folder not found, stop searching
                if (!foundFolder && i < parts.length - 1) {
                    break;
                }
            }
            
            // Open sidebar on mobile
            if (window.innerWidth < 1024) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.remove('hidden');
            }
        }
        
        // Navigate home (back to welcome screen)
        function navigateHome() {
            // Clear current PDF
            currentPdfPath = '';
            
            // Hide PDF container and show welcome message
            pdfContainer.classList.add('hidden');
            welcomeMessage.classList.remove('hidden');
            loadingIndicator.classList.add('hidden');
            
            // Remove active state from sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Collapse all folders
            collapseAllFolders();
            
            // Update URL to remove pdf parameter
            const url = new URL(window.location);
            url.searchParams.delete('pdf');
            window.history.pushState({}, '', url);
        }
        
        // Helper function to create breadcrumb separator SVG
        function createBreadcrumbSeparator() {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('class', 'h-3 w-3 mx-1 text-gray-400');
            svg.setAttribute('fill', 'currentColor');
            svg.setAttribute('viewBox', '0 0 20 20');
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('fill-rule', 'evenodd');
            path.setAttribute('d', 'M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z');
            path.setAttribute('clip-rule', 'evenodd');
            svg.appendChild(path);
            return svg;
        }
        
        // Update breadcrumb using DOM manipulation to prevent XSS
        function updateBreadcrumb(pdfPath) {
            const parts = pdfPath.split('/');
            
            // Clear existing breadcrumb
            breadcrumb.innerHTML = '';
            
            // Create Home link
            const homeLi = document.createElement('li');
            homeLi.className = 'flex items-center';
            const homeLink = document.createElement('a');
            homeLink.href = '#';
            homeLink.className = 'hover:text-blue-600 transition-colors cursor-pointer';
            homeLink.textContent = 'Home';
            homeLink.addEventListener('click', (e) => {
                e.preventDefault();
                navigateHome();
            });
            homeLi.appendChild(homeLink);
            breadcrumb.appendChild(homeLi);
            
            // Build path incrementally and create folder links
            let path = '';
            parts.forEach((part, index) => {
                const li = document.createElement('li');
                li.className = 'flex items-center';
                
                // Add separator
                li.appendChild(createBreadcrumbSeparator());
                
                if (index < parts.length - 1) {
                    // Folder link (clickable)
                    path += (path ? '/' : '') + part;
                    const folderPath = path; // Capture current path for closure
                    
                    const link = document.createElement('a');
                    link.href = '#';
                    link.className = 'text-gray-500 hover:text-blue-600 transition-colors cursor-pointer';
                    link.textContent = part;
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        navigateToFolder(folderPath);
                    });
                    li.appendChild(link);
                } else {
                    // Current file (non-clickable)
                    const span = document.createElement('span');
                    span.className = 'text-gray-700 font-medium truncate max-w-xs';
                    span.title = part;
                    span.textContent = part;
                    li.appendChild(span);
                }
                
                breadcrumb.appendChild(li);
            });
        }
        
        // Fullscreen functionality
        let isFullscreenActive = false;
        
        function toggleFullscreen() {
            const container = document.getElementById('pdfIframeContainer');
            
            if (!document.fullscreenElement && !document.webkitFullscreenElement && 
                !document.mozFullScreenElement && !document.msFullscreenElement) {
                // Enter fullscreen
                if (container.requestFullscreen) {
                    container.requestFullscreen().catch(err => {
                        console.error('Fullscreen error:', err);
                        showToast('Unable to enter fullscreen mode', 'error');
                    });
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.mozRequestFullScreen) {
                    container.mozRequestFullScreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                } else {
                    // Fallback for mobile devices that don't support fullscreen API
                    showToast('Fullscreen not supported. Try rotating your device.', 'info');
                }
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }
        
        // Handle fullscreen change events
        function handleFullscreenChange() {
            isFullscreenActive = !!(document.fullscreenElement || document.webkitFullscreenElement || 
                                    document.mozFullScreenElement || document.msFullscreenElement);
            
            if (isFullscreenActive) {
                document.body.classList.add('fullscreen-active');
                // Hide sidebar in fullscreen
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            } else {
                document.body.classList.remove('fullscreen-active');
            }
        }
        
        // Add fullscreen event listeners
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);
        
        fullscreenToggle.addEventListener('click', toggleFullscreen);
        
        // Zoom functionality
        function updateZoom(delta) {
            currentZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, currentZoom + delta));
            zoomLevel.textContent = Math.round(currentZoom * 100) + '%';
            
            if (usingCanvasRenderer && pdfDoc) {
                renderPDFWithCanvas(currentPdfPath);
            }
        }
        
        zoomIn.addEventListener('click', () => updateZoom(0.1));
        zoomOut.addEventListener('click', () => updateZoom(-0.1));
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Don't trigger shortcuts when typing in input fields
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                if (e.key === 'Escape') {
                    e.target.blur();
                }
                return;
            }
            
            // Help modal shortcut
            if (e.key === '?' || (e.shiftKey && e.key === '/')) {
                e.preventDefault();
                openHelpModal();
                return;
            }
            
            // Escape key to close modals
            if (e.key === 'Escape') {
                if (helpModal.classList.contains('active')) {
                    closeHelpModal();
                }
                return;
            }
            
            if (e.ctrlKey || e.metaKey) {
                if (e.key === '=' || e.key === '+') {
                    e.preventDefault();
                    updateZoom(0.1);
                } else if (e.key === '-') {
                    e.preventDefault();
                    updateZoom(-0.1);
                } else if (e.key === '0') {
                    e.preventDefault();
                    currentZoom = 1.0;
                    zoomLevel.textContent = '100%';
                    if (usingCanvasRenderer && pdfDoc) {
                        renderPDFWithCanvas(currentPdfPath);
                    }
                } else if (e.key === 'f') {
                    e.preventDefault();
                    searchInput.focus();
                }
            }
            
            // Arrow keys for page navigation in canvas mode
            if (usingCanvasRenderer && pdfDoc) {
                if (e.key === 'ArrowLeft' && currentPage > 1) {
                    goToPreviousPage();
                } else if (e.key === 'ArrowRight' && currentPage < pdfDoc.numPages) {
                    goToNextPage();
                }
            }
        });
        
        // Page navigation for canvas mode
        function goToPreviousPage() {
            if (currentPage > 1) {
                currentPage--;
                updatePageDisplay();
                scrollToPage(currentPage);
            }
        }
        
        function goToNextPage() {
            if (pdfDoc && currentPage < pdfDoc.numPages) {
                currentPage++;
                updatePageDisplay();
                scrollToPage(currentPage);
            }
        }
        
        function updatePageDisplay() {
            pageNum.textContent = currentPage;
        }
        
        function scrollToPage(page) {
            const canvases = pdfCanvasContainer.querySelectorAll('.pdf-page-canvas');
            if (canvases[page - 1]) {
                canvases[page - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        prevPage.addEventListener('click', goToPreviousPage);
        nextPage.addEventListener('click', goToNextPage);
        
        // Add to recent files
        function addToRecentFiles(pdfPath) {
            recentFiles = recentFiles.filter(f => f !== pdfPath);
            recentFiles.unshift(pdfPath);
            if (recentFiles.length > MAX_RECENT_FILES) {
                recentFiles = recentFiles.slice(0, MAX_RECENT_FILES);
            }
            localStorage.setItem('pdfRecentFiles', JSON.stringify(recentFiles));
            updateRecentSection();
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            }
        });

        // Initialize
        loadFileStructure();
        
        // Apply dark mode if previously set
        if (isDarkMode) {
            document.body.classList.add('dark-mode');
            darkModeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />';
        }
    </script>
</body>
</html>
