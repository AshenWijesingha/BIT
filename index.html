<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <meta name="description" content="BIT Repository - Browse and view PDF course materials for Bachelor of Information Technology program">
    <meta name="theme-color" content="#2563eb">
    <title>BIT Repository - PDF Viewer</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF.js library for rendering PDFs on all devices including mobile -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        /* Tailwind-like utility classes as fallback when CDN is blocked */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; }
        .min-h-screen { min-height: 100vh; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-white { background-color: #ffffff; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-blue-700 { background-color: #1d4ed8; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-gray-800 { background-color: #1f2937; }
        .text-white { color: #ffffff; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-400 { color: #9ca3af; }
        .text-yellow-500 { color: #eab308; }
        .text-red-500 { color: #ef4444; }
        .text-blue-500 { color: #3b82f6; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-base { font-size: 1rem; line-height: 1.5rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-center { text-align: center; }
        .flex { display: flex; }
        .inline-flex { display: inline-flex; }
        .hidden { display: none !important; }
        .block { display: block; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .flex-col { flex-direction: column; }
        .flex-1 { flex: 1 1 0%; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-shrink-0 { flex-shrink: 0; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .p-1\.5 { padding: 0.375rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-1\.5 { padding-top: 0.375rem; padding-bottom: 0.375rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .pt-16 { padding-top: 4rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-2 { margin-top: 0.5rem; }
        .ml-4 { margin-left: 1rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .w-64 { width: 16rem; }
        .w-80 { width: 20rem; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .h-3 { height: 0.75rem; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .h-6 { height: 1.5rem; }
        .h-12 { height: 3rem; }
        .h-16 { height: 4rem; }
        .h-20 { height: 5rem; }
        .h-24 { height: 6rem; }
        .w-3 { width: 0.75rem; }
        .w-4 { width: 1rem; }
        .w-5 { width: 1.25rem; }
        .w-6 { width: 1.5rem; }
        .w-12 { width: 3rem; }
        .w-16 { width: 4rem; }
        .w-20 { width: 5rem; }
        .w-24 { width: 6rem; }
        .max-w-xs { max-width: 20rem; }
        .max-w-sm { max-width: 24rem; }
        .max-w-md { max-width: 28rem; }
        .max-w-lg { max-width: 32rem; }
        .min-w-0 { min-width: 0; }
        .fixed { position: fixed; }
        .sticky { position: sticky; }
        .relative { position: relative; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .top-14 { top: 3.5rem; }
        .top-16 { top: 4rem; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        .overflow-y-auto { overflow-y: auto; }
        .overflow-x-hidden { overflow-x: hidden; }
        .overflow-hidden { overflow: hidden; }
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-t-lg { border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; }
        .rounded-b-lg { border-bottom-left-radius: 0.5rem; border-bottom-right-radius: 0.5rem; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .break-words { overflow-wrap: break-word; word-break: break-word; }
        .whitespace-nowrap { white-space: nowrap; }
        .cursor-pointer { cursor: pointer; }
        .transition-transform { transition-property: transform; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .duration-300 { transition-duration: 300ms; }
        .border { border-width: 1px; }
        .border-gray-200 { border-color: #e5e7eb; }
        
        /* Transform utilities */
        .-translate-x-full { transform: translateX(-100%); }
        .translate-x-0 { transform: translateX(0); }
        .rotate-90 { transform: rotate(90deg); }
        
        /* Hover states */
        .hover\:bg-gray-100:hover { background-color: #f3f4f6; }
        .hover\:bg-gray-300:hover { background-color: #d1d5db; }
        .hover\:bg-blue-600:hover { background-color: #2563eb; }
        .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\:bg-blue-800:hover { background-color: #1e40af; }
        
        /* Mobile-first responsive utilities */
        /* Extra small devices (phones, less than 480px) */
        @media (max-width: 480px) {
            .xs\:hidden { display: none !important; }
            .xs\:block { display: block !important; }
            .xs\:flex { display: flex !important; }
            .xs\:text-xs { font-size: 0.75rem; line-height: 1rem; }
            .xs\:text-sm { font-size: 0.875rem; line-height: 1.25rem; }
            .xs\:text-base { font-size: 1rem; line-height: 1.5rem; }
            .xs\:p-2 { padding: 0.5rem; }
            .xs\:p-3 { padding: 0.75rem; }
            .xs\:px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
            .xs\:py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
            .xs\:gap-1 { gap: 0.25rem; }
            .xs\:gap-2 { gap: 0.5rem; }
            .xs\:w-full { width: 100%; }
            .xs\:flex-col { flex-direction: column; }
            .xs\:flex-wrap { flex-wrap: wrap; }
            
            /* Improve touch targets for mobile - minimum 44x44px for accessibility */
            button, .sidebar-item, a[role="button"] { 
                min-height: 44px; 
                min-width: 44px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Better text sizes for mobile readability */
            body { font-size: 16px; } /* Prevent zoom on iOS */
            
            /* Adjust header for mobile */
            header h1 { font-size: 1rem; }
            
            /* Make buttons more prominent on mobile */
            header button { padding: 0.5rem; }
        }
        
        /* Small devices (phones, 480px and up) */
        @media (min-width: 480px) {
            .sm\:hidden { display: none !important; }
            .sm\:block { display: block !important; }
            .sm\:inline { display: inline !important; }
            .sm\:inline-flex { display: inline-flex !important; }
            .sm\:flex { display: flex !important; }
            .sm\:text-sm { font-size: 0.875rem; line-height: 1.25rem; }
            .sm\:text-base { font-size: 1rem; line-height: 1.5rem; }
            .sm\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
            .sm\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
            .sm\:p-2 { padding: 0.5rem; }
            .sm\:p-3 { padding: 0.75rem; }
            .sm\:p-4 { padding: 1rem; }
            .sm\:p-6 { padding: 1.5rem; }
            .sm\:px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
            .sm\:px-4 { padding-left: 1rem; padding-right: 1rem; }
            .sm\:py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
            .sm\:py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
            .sm\:gap-1 { gap: 0.25rem; }
            .sm\:gap-2 { gap: 0.5rem; }
            .sm\:gap-3 { gap: 0.75rem; }
            .sm\:gap-4 { gap: 1rem; }
            .sm\:mb-4 { margin-bottom: 1rem; }
            .sm\:h-5 { height: 1.25rem; }
            .sm\:w-5 { width: 1.25rem; }
            .sm\:h-6 { height: 1.5rem; }
            .sm\:w-6 { width: 1.5rem; }
            .sm\:h-4 { height: 1rem; }
            .sm\:w-4 { width: 1rem; }
            .sm\:h-20 { height: 5rem; }
            .sm\:w-20 { width: 5rem; }
            .sm\:flex-row { flex-direction: row; }
        }
        
        /* Medium devices (tablets, 768px and up) */
        @media (min-width: 768px) {
            .md\:hidden { display: none !important; }
            .md\:block { display: block !important; }
            .md\:inline-flex { display: inline-flex !important; }
            .md\:flex { display: flex !important; }
            .md\:text-base { font-size: 1rem; line-height: 1.5rem; }
            .md\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
            .md\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
            .md\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
            .md\:p-3 { padding: 0.75rem; }
            .md\:p-4 { padding: 1rem; }
            .md\:p-6 { padding: 1.5rem; }
            .md\:p-8 { padding: 2rem; }
            .md\:px-4 { padding-left: 1rem; padding-right: 1rem; }
            .md\:gap-3 { gap: 0.75rem; }
            .md\:gap-4 { gap: 1rem; }
            .md\:h-24 { height: 6rem; }
            .md\:w-24 { width: 6rem; }
            .md\:flex-row { flex-direction: row; }
        }
        
        /* Large devices (desktops, 1024px and up) */
        @media (min-width: 1024px) {
            .lg\:ml-80 { margin-left: 20rem; }
            .lg\:translate-x-0 { transform: translateX(0); }
            .lg\:hidden { display: none !important; }
            .lg\:block { display: block !important; }
            .lg\:inline-flex { display: inline-flex !important; }
            .lg\:flex { display: flex !important; }
            .lg\:text-base { font-size: 1rem; line-height: 1.5rem; }
            .lg\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
            .lg\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
            .lg\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
            .lg\:p-4 { padding: 1rem; }
            .lg\:p-8 { padding: 2rem; }
            .lg\:gap-4 { gap: 1rem; }
        }
        
        /* Extra large devices (large desktops, 1280px and up) */
        @media (min-width: 1280px) {
            .xl\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
            .xl\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
            .xl\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
            .xl\:text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
            .xl\:p-6 { padding: 1.5rem; }
            .xl\:gap-6 { gap: 1.5rem; }
        }
        
        /* 2X large devices (larger desktops, 1536px and up) */
        @media (min-width: 1536px) {
            .\32xl\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
            .\32xl\:text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
            .\32xl\:p-8 { padding: 2rem; }
        }
        
        /* Landscape orientation optimization for mobile devices */
        @media (max-width: 768px) and (orientation: landscape) {
            .header-height { height: 48px; }
            .header-spacing { padding-top: 48px; }
            .sidebar-position { top: 48px; height: calc(100vh - 48px); }
            #pdfCanvasContainer { height: calc(100vh - 10rem); }
        }

        /* Custom scrollbar styling */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Active sidebar item */
        .sidebar-item.active { background-color: #3b82f6; color: white; }
        .sidebar-item.active span { color: white; }
        .sidebar-item.active svg { color: white; }
        
        /* Folder expansion animation */
        .folder-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .folder-content.expanded { max-height: 5000px; }
        
        /* PDF container - responsive heights */
        .pdf-iframe-container {
            background: #525659;
            min-height: calc(100vh - 10rem);
            border-radius: 0 0 0.5rem 0.5rem;
            overflow: auto;
        }
        
        .pdf-iframe-container iframe,
        .pdf-iframe-container object {
            width: 100%;
            height: calc(100vh - 10rem);
            border: none;
            border-radius: 0 0 0.5rem 0.5rem;
        }
        
        /* PDF.js canvas rendering container */
        #pdfCanvasContainer {
            width: 100%;
            height: calc(100vh - 10rem);
            overflow: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            gap: 1rem;
        }
        
        .pdf-page-canvas {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            background: white;
            /* Improve canvas rendering quality - smooth rendering for PDFs */
            image-rendering: auto;
            /* For better quality on high-DPI displays - enable hardware acceleration */
            -webkit-backface-visibility: hidden;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }
        
        @media (max-width: 768px) {
            .pdf-iframe-container {
                min-height: calc(100vh - 14rem);
            }
            .pdf-iframe-container iframe,
            .pdf-iframe-container object {
                height: calc(100vh - 14rem);
            }
            #pdfCanvasContainer {
                height: calc(100vh - 14rem);
            }
        }
        
        /* Responsive sidebar width */
        .sidebar-responsive {
            width: 100%;
            max-width: 20rem;
        }
        
        @media (min-width: 480px) {
            .sidebar-responsive {
                width: 20rem;
            }
        }
        
        /* Loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Sidebar overlay */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 30;
        }
        
        /* Header height constants */
        .header-height { height: 56px; }
        .header-spacing { padding-top: 56px; }
        .sidebar-position { top: 56px; height: calc(100vh - 56px); }
        .main-min-height { min-height: calc(100vh - 56px); }
        .content-min-height { min-height: calc(100vh - 7rem); }
        
        /* Ensure proper height calculations */
        html, body { height: 100%; }
        
        /* Smooth scrolling */
        html { scroll-behavior: smooth; }
        
        /* Improve text rendering */
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Focus visible for accessibility */
        *:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* Prevent horizontal scroll on mobile */
        body {
            overflow-x: hidden;
        }
        
        /* Safe area insets for notched devices */
        @supports (padding: max(0px)) {
            header {
                padding-left: max(0.75rem, env(safe-area-inset-left));
                padding-right: max(0.75rem, env(safe-area-inset-right));
            }
            .sidebar-responsive {
                padding-left: max(0, env(safe-area-inset-left));
            }
        }
        
        /* Dark mode styles */
        body.dark-mode {
            background-color: #111827;
            color: #f3f4f6;
        }
        
        body.dark-mode .bg-white { background-color: #1f2937; }
        body.dark-mode .bg-gray-100 { background-color: #111827; }
        body.dark-mode .bg-gray-200 { background-color: #374151; }
        body.dark-mode .text-gray-600 { color: #d1d5db; }
        body.dark-mode .text-gray-700 { color: #e5e7eb; }
        body.dark-mode .text-gray-800 { color: #f3f4f6; }
        body.dark-mode .text-gray-500 { color: #9ca3af; }
        body.dark-mode .border-gray-200 { border-color: #374151; }
        body.dark-mode .hover\:bg-gray-100:hover { background-color: #374151; }
        body.dark-mode .hover\:bg-gray-300:hover { background-color: #4b5563; }
        body.dark-mode .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3); }
        body.dark-mode .pdf-iframe-container { background: #1f2937; }
        body.dark-mode input {
            background-color: #374151;
            border-color: #4b5563;
            color: #f3f4f6;
        }
        body.dark-mode input::placeholder {
            color: #9ca3af;
        }
        body.dark-mode input:focus {
            background-color: #4b5563;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-lg fixed w-full z-50 header-height">
        <div class="px-3 sm:px-4 py-2 sm:py-3 flex items-center justify-between h-full">
            <h1 class="text-base sm:text-lg md:text-xl lg:text-2xl font-bold flex items-center gap-1 sm:gap-2 min-w-0">
                <span class="flex-shrink-0">ðŸ“š</span>
                <span class="truncate">BIT Repository</span>
                <span class="hidden sm:inline truncate"> - PDF Viewer</span>
            </h1>
            <div class="flex items-center gap-2">
                <!-- Dark Mode Toggle -->
                <button id="darkModeToggle" class="bg-blue-700 hover:bg-blue-800 px-2 sm:px-3 py-2 rounded flex-shrink-0 transition-colors" aria-label="Toggle dark mode" title="Toggle dark mode">
                    <svg id="darkModeIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
                <!-- Sidebar Toggle -->
                <button id="toggleSidebar" class="lg:hidden bg-blue-700 hover:bg-blue-800 px-2 sm:px-3 py-2 rounded flex-shrink-0 transition-colors" aria-label="Toggle sidebar" title="Toggle sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div class="flex header-spacing">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar-responsive sidebar-position bg-white shadow-lg fixed overflow-y-auto transition-all duration-300 z-40 -translate-x-full lg:translate-x-0">
            <div class="p-3 sm:p-4">
                <h2 class="text-sm sm:text-base lg:text-lg font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                    </svg>
                    <span>PDF Files</span>
                </h2>
                
                <!-- Search Bar -->
                <div class="mb-3 sm:mb-4 relative">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Search PDFs..." 
                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        aria-label="Search PDF files"
                    />
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-400 absolute right-3 top-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                
                <div id="fileTree" class="space-y-2">
                    <!-- File tree will be dynamically populated by buildFileTree() function -->
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 lg:ml-80 p-2 sm:p-3 md:p-4 main-min-height">
            <!-- Welcome Message -->
            <div id="welcomeMessage" class="flex flex-col items-center justify-center text-center content-min-height">
                <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 max-w-md mx-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 sm:h-24 sm:w-24 mx-auto text-blue-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3">Welcome to BIT Repository</h2>
                    <p class="text-base text-gray-600 mb-4">Select a PDF file from the sidebar to start viewing.</p>
                    <p class="text-sm text-gray-500 mb-4">This repository contains course materials for the Bachelor of Information Technology program.</p>
                    <button onclick="document.getElementById('toggleSidebar').click()" class="lg:hidden bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                        Browse Files
                    </button>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="hidden flex-col items-center justify-center content-min-height">
                <div class="bg-white rounded-xl shadow-lg p-8 max-w-sm mx-4">
                    <div class="loader mb-4 mx-auto"></div>
                    <p class="text-base text-gray-700 font-medium">Loading PDF...</p>
                    <p class="text-sm text-gray-500 mt-2">Please wait while we prepare your document</p>
                </div>
            </div>

            <!-- PDF Viewer Container -->
            <div id="pdfContainer" class="hidden">
                <!-- Breadcrumb Navigation -->
                <nav class="mb-2 sm:mb-3" aria-label="Breadcrumb">
                    <ol id="breadcrumb" class="flex items-center flex-wrap gap-1 text-xs sm:text-sm text-gray-600">
                        <li class="flex items-center">
                            <a href="#" class="hover:text-blue-600 transition-colors" onclick="event.preventDefault();">Home</a>
                        </li>
                    </ol>
                </nav>
                
                <!-- PDF Controls -->
                <div class="bg-white rounded-t-lg shadow-lg p-2 sm:p-3 md:p-4 sticky top-14 z-30">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3 md:gap-4">
                        <div class="flex items-center gap-2 min-w-0 flex-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-red-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <h3 id="pdfTitle" class="text-sm sm:text-base md:text-lg font-semibold text-gray-700 truncate"></h3>
                            <button id="favoritePdf" class="flex-shrink-0 text-gray-400 hover:text-yellow-500 transition-colors" aria-label="Add to favorites" title="Add to favorites">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                                </svg>
                            </button>
                        </div>
                        <div class="flex items-center gap-2 flex-wrap">
                            <!-- Zoom Controls -->
                            <div class="hidden sm:flex items-center gap-1 bg-gray-100 rounded px-2 py-1">
                                <button id="zoomOut" class="hover:bg-gray-200 p-1 rounded transition-colors" aria-label="Zoom out" title="Zoom out">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7" />
                                    </svg>
                                </button>
                                <span id="zoomLevel" class="text-xs font-medium min-w-[3rem] text-center">100%</span>
                                <button id="zoomIn" class="hover:bg-gray-200 p-1 rounded transition-colors" aria-label="Zoom in" title="Zoom in">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7" />
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- Fullscreen Toggle -->
                            <button id="fullscreenToggle" class="bg-gray-200 hover:bg-gray-300 px-2 sm:px-3 py-1.5 sm:py-2 rounded flex items-center gap-1 transition-all text-gray-700 text-xs sm:text-sm" aria-label="Toggle fullscreen" title="Toggle fullscreen">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                                </svg>
                                <span class="hidden md:inline">Fullscreen</span>
                            </button>
                            
                            <!-- Download Button -->
                            <a id="downloadPdf" href="#" download class="bg-blue-500 hover:bg-blue-600 text-white px-2 sm:px-3 md:px-4 py-1.5 sm:py-2 rounded flex items-center gap-1 sm:gap-2 transition-all text-xs sm:text-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </svg>
                                <span class="hidden sm:inline">Download</span>
                            </a>
                            
                            <!-- Open in New Tab -->
                            <a id="openInNewTab" href="#" target="_blank" class="bg-gray-200 hover:bg-gray-300 px-2 sm:px-3 md:px-4 py-1.5 sm:py-2 rounded flex items-center gap-1 sm:gap-2 transition-all text-gray-700 text-xs sm:text-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                                <span class="hidden sm:inline">New Tab</span>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Page Navigation for Canvas Mode -->
                    <div id="pageNavigation" class="hidden mt-2 sm:mt-3 flex items-center justify-center gap-2 border-t border-gray-200 pt-2 sm:pt-3">
                        <button id="prevPage" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded text-sm transition-colors" aria-label="Previous page">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <span id="pageInfo" class="text-sm text-gray-600">Page <span id="pageNum">1</span> of <span id="pageCount">1</span></span>
                        <button id="nextPage" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded text-sm transition-colors" aria-label="Next page">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                </div>
                <!-- PDF Container -->
                <div id="pdfIframeContainer" class="pdf-iframe-container">
                    <!-- Native PDF viewer using object tag (works on desktop) -->
                    <object id="pdfViewer" type="application/pdf" width="100%" height="100%" style="min-height: calc(100vh - 10rem);">
                        <iframe id="pdfViewerFallback" title="PDF Viewer" width="100%" height="100%" style="min-height: calc(100vh - 10rem);"></iframe>
                    </object>
                    <!-- PDF.js canvas rendering for mobile devices -->
                    <div id="pdfCanvasContainer" class="hidden"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div id="sidebarOverlay" class="sidebar-overlay hidden lg:hidden"></div>

    <script>
        // Configure PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
        
        // Constants
        const PDF_LOAD_TIMEOUT_MS = 3000; // Fallback timeout for PDF loading
        const INDENT_SIZE_PX = 12; // Indentation for nested sidebar items
        const PDF_VIEW_MODE = '#view=FitH'; // Default PDF view mode
        const CANVAS_CONTAINER_PADDING = 32; // Padding for canvas container (2 * 1rem)
        const MIN_ZOOM = 0.5; // Minimum zoom level (50%)
        const MAX_ZOOM = 3.0; // Maximum zoom level (300%)
        const MAX_RECENT_FILES = 10; // Maximum number of recent files to track

        // PDF Files - loaded dynamically from files.json
        let pdfFiles = {};

        // State variables
        let currentPdfPath = '';
        let pdfDoc = null;
        let usingCanvasRenderer = false;
        let currentZoom = 1.0;
        let currentPage = 1;
        let favorites = JSON.parse(localStorage.getItem('pdfFavorites') || '[]');
        let recentFiles = JSON.parse(localStorage.getItem('pdfRecentFiles') || '[]');
        let isDarkMode = localStorage.getItem('darkMode') === 'true';

        // DOM Elements
        const fileTree = document.getElementById('fileTree');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const pdfContainer = document.getElementById('pdfContainer');
        const pdfTitle = document.getElementById('pdfTitle');
        const downloadPdf = document.getElementById('downloadPdf');
        const openInNewTab = document.getElementById('openInNewTab');
        const pdfViewer = document.getElementById('pdfViewer');
        const pdfViewerFallback = document.getElementById('pdfViewerFallback');
        const pdfCanvasContainer = document.getElementById('pdfCanvasContainer');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const searchInput = document.getElementById('searchInput');
        const breadcrumb = document.getElementById('breadcrumb');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = document.getElementById('darkModeIcon');
        const favoritePdf = document.getElementById('favoritePdf');
        const fullscreenToggle = document.getElementById('fullscreenToggle');
        const zoomIn = document.getElementById('zoomIn');
        const zoomOut = document.getElementById('zoomOut');
        const zoomLevel = document.getElementById('zoomLevel');
        const pageNavigation = document.getElementById('pageNavigation');
        const prevPage = document.getElementById('prevPage');
        const nextPage = document.getElementById('nextPage');
        const pageNum = document.getElementById('pageNum');
        const pageCount = document.getElementById('pageCount');
        
        // Detect if device likely supports native PDF viewing
        function supportsNativePDFViewing() {
            // Mobile devices typically don't support inline PDF viewing
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            return !isMobile;
        }
        
        // Helper function to hide loading indicator
        function hideLoadingIndicator() {
            loadingIndicator.classList.add('hidden');
            loadingIndicator.style.display = '';
        }
        
        // Helper function to show loading indicator
        function showLoadingIndicator() {
            welcomeMessage.classList.add('hidden');
            pdfContainer.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            loadingIndicator.style.display = 'flex';
        }

        // Load file structure from JSON
        async function loadFileStructure() {
            try {
                const response = await fetch('files.json');
                if (!response.ok) {
                    throw new Error('Failed to load file structure');
                }
                pdfFiles = await response.json();
                buildFileTree();
            } catch (error) {
                console.error('Error loading file structure:', error);
                // Show error message to user
                fileTree.innerHTML = `
                    <div class="p-4 text-center text-red-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p class="text-sm font-medium">Failed to load file list</p>
                        <p class="text-xs mt-1">Please refresh the page</p>
                    </div>
                `;
            }
        }

        // Build file tree
        function buildFileTree() {
            fileTree.innerHTML = '';
            
            if (Object.keys(pdfFiles).length === 0) {
                fileTree.innerHTML = `
                    <div class="p-4 text-center text-gray-500">
                        <p class="text-sm">Loading files...</p>
                    </div>
                `;
                return;
            }
            
            for (const [folder, content] of Object.entries(pdfFiles)) {
                const folderElement = createFolderElement(folder, content);
                fileTree.appendChild(folderElement);
            }
        }

        function createFolderElement(name, content, level = 0) {
            const container = document.createElement('div');
            container.className = 'folder-container';
            
            // Folder header - responsive margin calculation with better touch targets
            const header = document.createElement('div');
            header.className = 'flex items-center gap-1 sm:gap-2 p-2 rounded cursor-pointer hover:bg-gray-100 transition-colors';
            header.style.marginLeft = (level * INDENT_SIZE_PX) + 'px';
            header.style.minHeight = '44px'; // Touch target size
            header.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                </svg>
                <span class="text-sm font-medium text-gray-700 flex-1 truncate" title="${name}">${name}</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 chevron transition-transform flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            `;
            
            // Folder content
            const contentDiv = document.createElement('div');
            contentDiv.className = 'folder-content';
            
            if (Array.isArray(content)) {
                // Simple array of files
                content.forEach(file => {
                    const fileElement = createFileElement(file, level + 1);
                    contentDiv.appendChild(fileElement);
                });
            } else {
                // Object with subfolders and _root files
                if (content._root) {
                    content._root.forEach(file => {
                        const fileElement = createFileElement(file, level + 1);
                        contentDiv.appendChild(fileElement);
                    });
                }
                
                // Subfolders
                for (const [subFolder, subContent] of Object.entries(content)) {
                    if (subFolder !== '_root') {
                        const subFolderElement = createFolderElement(subFolder, subContent, level + 1);
                        contentDiv.appendChild(subFolderElement);
                    }
                }
            }
            
            // Toggle folder expansion
            header.addEventListener('click', () => {
                contentDiv.classList.toggle('expanded');
                header.querySelector('.chevron').classList.toggle('rotate-90');
            });
            
            container.appendChild(header);
            container.appendChild(contentDiv);
            
            return container;
        }

        function createFileElement(filePath, level) {
            const fileName = filePath.split('/').pop().replace('.pdf', '');
            const element = document.createElement('div');
            element.className = 'sidebar-item flex items-center gap-1 sm:gap-2 p-2 rounded cursor-pointer hover:bg-gray-100 transition-colors';
            element.style.marginLeft = (level * INDENT_SIZE_PX) + 'px';
            element.style.minHeight = '44px'; // Touch target size
            element.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <span class="text-sm text-gray-600 truncate" title="${fileName}">${fileName}</span>
            `;
            element.dataset.path = filePath;
            element.addEventListener('click', () => loadPdf(filePath));
            return element;
        }

        // Render PDF using PDF.js for mobile devices
        async function renderPDFWithCanvas(pdfPath) {
            try {
                // Clean up previous PDF document if exists
                if (pdfDoc) {
                    await pdfDoc.destroy();
                    pdfDoc = null;
                }
                
                pdfCanvasContainer.innerHTML = '<p class="text-white text-center">Loading PDF...</p>';
                
                // Load PDF document with high-quality rendering options
                const loadingTask = pdfjsLib.getDocument({
                    url: pdfPath,
                    // Enable high-quality rendering options
                    disableAutoFetch: false,
                    enableXfa: true
                });
                pdfDoc = await loadingTask.promise;
                
                // Clear container
                pdfCanvasContainer.innerHTML = '';
                
                // Show page navigation
                pageNavigation.classList.remove('hidden');
                pageCount.textContent = pdfDoc.numPages;
                currentPage = 1;
                updatePageDisplay();
                
                // Get container width before rendering
                const containerWidth = Math.max(pdfCanvasContainer.clientWidth - CANVAS_CONTAINER_PADDING, 300);
                
                // Get device pixel ratio for high-DPI displays
                const devicePixelRatio = window.devicePixelRatio || 1;
                
                // Render all pages
                for (let pageNum = 1; pageNum <= pdfDoc.numPages; pageNum++) {
                    const page = await pdfDoc.getPage(pageNum);
                    
                    // Create canvas
                    const canvas = document.createElement('canvas');
                    canvas.className = 'pdf-page-canvas';
                    canvas.dataset.pageNum = pageNum;
                    const context = canvas.getContext('2d', { alpha: false });
                    
                    // Calculate scale to fit screen width with zoom
                    const viewport = page.getViewport({ scale: 1 });
                    const scale = (containerWidth / viewport.width) * currentZoom;
                    
                    // Apply device pixel ratio for high-quality rendering on high-DPI displays
                    const outputScale = devicePixelRatio;
                    const scaledViewport = page.getViewport({ scale: scale * outputScale });
                    
                    // Set canvas dimensions to match the scaled viewport
                    canvas.width = scaledViewport.width;
                    canvas.height = scaledViewport.height;
                    
                    // Set CSS dimensions to display at correct size
                    canvas.style.width = Math.floor(scaledViewport.width / outputScale) + 'px';
                    canvas.style.height = Math.floor(scaledViewport.height / outputScale) + 'px';
                    
                    // Configure canvas context for high-quality rendering
                    context.imageSmoothingEnabled = true;
                    context.imageSmoothingQuality = 'high';
                    
                    // Render page with high-quality settings
                    await page.render({
                        canvasContext: context,
                        viewport: scaledViewport,
                        intent: 'display',
                        renderInteractiveForms: true
                    }).promise;
                    
                    pdfCanvasContainer.appendChild(canvas);
                }
                
                // Hide loading and show container
                hideLoadingIndicator();
                pdfContainer.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error rendering PDF:', error);
                hideLoadingIndicator();
                welcomeMessage.classList.remove('hidden');
                alert('Error loading PDF file. Please try the "Open in New Tab" option or download the file.');
            }
        }

        // Load and display PDF using object tag with iframe fallback or PDF.js canvas
        async function loadPdf(pdfPath) {
            // Update active state in sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.path === pdfPath) {
                    item.classList.add('active');
                }
            });
            
            // Show loading
            showLoadingIndicator();
            
            // Close sidebar on mobile
            closeSidebar();
            
            currentPdfPath = pdfPath;
            const encodedPath = encodeURI(pdfPath);
            const fileName = pdfPath.split('/').pop();
            
            // Update UI
            pdfTitle.textContent = fileName;
            downloadPdf.href = encodedPath;
            downloadPdf.download = fileName;
            openInNewTab.href = encodedPath;
            
            // Update breadcrumb
            updateBreadcrumb(pdfPath);
            
            // Update favorite button
            if (favorites.includes(pdfPath)) {
                favoritePdf.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>';
                favoritePdf.classList.remove('text-gray-400');
                favoritePdf.classList.add('text-yellow-500');
            } else {
                favoritePdf.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>';
                favoritePdf.classList.remove('text-yellow-500');
                favoritePdf.classList.add('text-gray-400');
            }
            
            // Add to recent files
            addToRecentFiles(pdfPath);
            
            // Reset zoom
            currentZoom = 1.0;
            zoomLevel.textContent = '100%';
            
            // Check if we should use PDF.js canvas rendering (for mobile)
            const usePDFjs = typeof pdfjsLib !== 'undefined' && !supportsNativePDFViewing();
            usingCanvasRenderer = usePDFjs;
            
            if (usePDFjs) {
                // Use PDF.js canvas rendering for mobile devices
                pdfViewer.classList.add('hidden');
                pdfViewerFallback.classList.add('hidden');
                pdfCanvasContainer.classList.remove('hidden');
                
                await renderPDFWithCanvas(encodedPath);
            } else {
                // Use native PDF viewing for desktop
                // Clean up PDF.js document if switching from canvas mode
                if (pdfDoc) {
                    pdfDoc.destroy().catch(() => {}); // Ignore errors
                    pdfDoc = null;
                }
                
                // Hide page navigation for native mode
                pageNavigation.classList.add('hidden');
                
                pdfViewer.classList.remove('hidden');
                pdfCanvasContainer.classList.add('hidden');
                
                // Set PDF URL with view parameters for better display
                const pdfUrl = encodedPath + PDF_VIEW_MODE;
                
                // Load PDF using object tag (better mobile support)
                pdfViewer.onload = function() {
                    hideLoadingIndicator();
                    pdfContainer.classList.remove('hidden');
                };
                
                pdfViewer.onerror = function() {
                    hideLoadingIndicator();
                    welcomeMessage.classList.remove('hidden');
                    alert('Error loading PDF file. Please try again or use the "Open in New Tab" option.');
                };
                
                // Set the data attribute on object tag for PDF
                pdfViewer.setAttribute('data', pdfUrl);
                
                // Also set the fallback iframe source
                pdfViewerFallback.src = pdfUrl;
                
                // Fallback timeout in case onload doesn't fire
                setTimeout(() => {
                    if (loadingIndicator.style.display === 'flex') {
                        hideLoadingIndicator();
                        pdfContainer.classList.remove('hidden');
                    }
                }, PDF_LOAD_TIMEOUT_MS);
            }
        }

        // Sidebar toggle for mobile
        document.getElementById('toggleSidebar').addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        });

        sidebarOverlay.addEventListener('click', closeSidebar);

        function closeSidebar() {
            if (window.innerWidth < 1024) {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            }
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            }
            
            // Re-render PDF if using canvas mode and zoom is active
            if (usingCanvasRenderer && pdfDoc && currentZoom !== 1.0) {
                renderPDFWithCanvas(currentPdfPath);
            }
        });
        
        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            const allItems = fileTree.querySelectorAll('.sidebar-item, .folder-container');
            
            if (searchTerm === '') {
                // Show all items
                allItems.forEach(item => {
                    item.style.display = '';
                });
                // Collapse all folders
                fileTree.querySelectorAll('.folder-content').forEach(content => {
                    content.classList.remove('expanded');
                });
                fileTree.querySelectorAll('.chevron').forEach(chevron => {
                    chevron.classList.remove('rotate-90');
                });
            } else {
                // Hide all items first
                allItems.forEach(item => {
                    item.style.display = 'none';
                });
                
                // Show matching items and their parents
                const items = fileTree.querySelectorAll('.sidebar-item');
                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        item.style.display = '';
                        
                        // Show parent folders
                        let parent = item.parentElement;
                        while (parent && parent !== fileTree) {
                            parent.style.display = '';
                            if (parent.classList.contains('folder-content')) {
                                parent.classList.add('expanded');
                                const header = parent.previousElementSibling;
                                if (header) {
                                    const chevron = header.querySelector('.chevron');
                                    if (chevron) chevron.classList.add('rotate-90');
                                }
                            }
                            parent = parent.parentElement;
                        }
                    }
                });
            }
        });
        
        // Dark mode toggle
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            localStorage.setItem('darkMode', isDarkMode);
            
            // Update icon
            if (isDarkMode) {
                darkModeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />';
            } else {
                darkModeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />';
            }
        }
        
        darkModeToggle.addEventListener('click', toggleDarkMode);
        
        // Initialize dark mode
        if (isDarkMode) {
            toggleDarkMode();
        }
        
        // Favorites functionality
        function toggleFavorite() {
            if (!currentPdfPath) return;
            
            const index = favorites.indexOf(currentPdfPath);
            if (index > -1) {
                favorites.splice(index, 1);
                favoritePdf.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>';
                favoritePdf.classList.remove('text-yellow-500');
                favoritePdf.classList.add('text-gray-400');
            } else {
                favorites.push(currentPdfPath);
                favoritePdf.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>';
                favoritePdf.classList.remove('text-gray-400');
                favoritePdf.classList.add('text-yellow-500');
            }
            
            localStorage.setItem('pdfFavorites', JSON.stringify(favorites));
        }
        
        favoritePdf.addEventListener('click', toggleFavorite);
        
        // Update breadcrumb
        function updateBreadcrumb(pdfPath) {
            const parts = pdfPath.split('/');
            breadcrumb.innerHTML = '<li class="flex items-center"><a href="#" class="hover:text-blue-600 transition-colors" onclick="event.preventDefault();">Home</a></li>';
            
            let path = '';
            parts.forEach((part, index) => {
                if (index < parts.length - 1) {
                    path += (path ? '/' : '') + part;
                    breadcrumb.innerHTML += `
                        <li class="flex items-center">
                            <svg class="h-3 w-3 mx-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span class="text-gray-500">${part}</span>
                        </li>
                    `;
                } else {
                    breadcrumb.innerHTML += `
                        <li class="flex items-center">
                            <svg class="h-3 w-3 mx-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span class="text-gray-700 font-medium">${part}</span>
                        </li>
                    `;
                }
            });
        }
        
        // Fullscreen functionality
        function toggleFullscreen() {
            const container = document.getElementById('pdfIframeContainer');
            
            if (!document.fullscreenElement) {
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }
        
        fullscreenToggle.addEventListener('click', toggleFullscreen);
        
        // Zoom functionality
        function updateZoom(delta) {
            currentZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, currentZoom + delta));
            zoomLevel.textContent = Math.round(currentZoom * 100) + '%';
            
            if (usingCanvasRenderer && pdfDoc) {
                renderPDFWithCanvas(currentPdfPath);
            }
        }
        
        zoomIn.addEventListener('click', () => updateZoom(0.1));
        zoomOut.addEventListener('click', () => updateZoom(-0.1));
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === '=' || e.key === '+') {
                    e.preventDefault();
                    updateZoom(0.1);
                } else if (e.key === '-') {
                    e.preventDefault();
                    updateZoom(-0.1);
                } else if (e.key === '0') {
                    e.preventDefault();
                    currentZoom = 1.0;
                    zoomLevel.textContent = '100%';
                    if (usingCanvasRenderer && pdfDoc) {
                        renderPDFWithCanvas(currentPdfPath);
                    }
                } else if (e.key === 'f') {
                    e.preventDefault();
                    searchInput.focus();
                }
            }
            
            // Arrow keys for page navigation in canvas mode
            if (usingCanvasRenderer && pdfDoc) {
                if (e.key === 'ArrowLeft' && currentPage > 1) {
                    goToPreviousPage();
                } else if (e.key === 'ArrowRight' && currentPage < pdfDoc.numPages) {
                    goToNextPage();
                }
            }
        });
        
        // Page navigation for canvas mode
        function goToPreviousPage() {
            if (currentPage > 1) {
                currentPage--;
                updatePageDisplay();
                scrollToPage(currentPage);
            }
        }
        
        function goToNextPage() {
            if (pdfDoc && currentPage < pdfDoc.numPages) {
                currentPage++;
                updatePageDisplay();
                scrollToPage(currentPage);
            }
        }
        
        function updatePageDisplay() {
            pageNum.textContent = currentPage;
        }
        
        function scrollToPage(page) {
            const canvases = pdfCanvasContainer.querySelectorAll('.pdf-page-canvas');
            if (canvases[page - 1]) {
                canvases[page - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        prevPage.addEventListener('click', goToPreviousPage);
        nextPage.addEventListener('click', goToNextPage);
        
        // Add to recent files
        function addToRecentFiles(pdfPath) {
            recentFiles = recentFiles.filter(f => f !== pdfPath);
            recentFiles.unshift(pdfPath);
            if (recentFiles.length > MAX_RECENT_FILES) {
                recentFiles = recentFiles.slice(0, MAX_RECENT_FILES);
            }
            localStorage.setItem('pdfRecentFiles', JSON.stringify(recentFiles));
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            }
        });

        // Initialize
        loadFileStructure();
    </script>
</body>
</html>
